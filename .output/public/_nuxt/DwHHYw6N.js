const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./O9dB02R4.js","./B_OshFF3.js","./DjTJqZtn.js","./entry.DofVldok.css"])))=>i.map(i=>d[i]);
import{d as H,x as Z,k as P,r as f,ab as J,M as K,an as Q,aq as Y,ar as ee,z as V,A as g,C as _,ap as ae,E as o,D as p,B as b,G as k,as as te,Z as w,R as S,S as D,a2 as L,at as le,$ as se,F as A,L as B,V as R,_ as oe}from"./DjTJqZtn.js";const ne={class:"customer-dialog"},re={class:"mb-5"},ue={class:"mb-2.5 text-sm"},ie={class:"mb-2.5 text-sm"},de=H({__name:"export",props:{modelValue:{type:Boolean},selectIds:{},tableData:{},taskId:{},fileId:{},translateLang:{}},emits:["update:modelValue","confirm"],setup(O,{emit:U}){const{t:n}=Z(),t=O,q=U,m=P({get:()=>t.modelValue,set:r=>q("update:modelValue",r)}),u=f([]),j=f([{value:"pdf",label:"PDF"},{value:"docx",label:"DOCX"},{value:"txt",label:"TXT"},{value:"vtt",label:"VTT"},{value:"csv",label:"CSV"},{value:"srt",label:"SRT"}]),z=f([{value:"speaker",label:n("FolderPage.dialog.export.speaker")},{value:"timecodes",label:n("FolderPage.dialog.export.timecodes")}]),d=f(["timecodes","speaker"]);let E=null;const N=()=>{u.value=[],d.value=["timecodes","speaker"],clearTimeout(E),i.value=!1},{userInfo:G}=J(K()),F=P(()=>!!G.value),i=f(!1),h=Q(),{addExportTask:M}=Y(),W=async()=>{var r,a,s,l;try{if(!u.value.length){B.error({message:n("FolderPage.dialog.export.selectErr"),customClass:"!z-[9999]"});return}i.value=!0;const c=[],v=[];if((r=t.selectIds)!=null&&r.length)for(const I of t.selectIds){const y=(a=t.tableData)==null?void 0:a.find($=>$.id===I);y&&(c.push(y.taskId),v.push(y.fileId))}else c.push(t.taskId),v.push(t.fileId);const e={fileType:u.value.join(","),taskIds:c.join(","),fileIds:v.join(","),haveSpeaker:+d.value.includes("speaker"),haveTimestamp:+d.value.includes("timecodes")};h.query.shareId&&(e.userId=h.query.shareId),t.translateLang&&(e.translateLang=t.translateLang,e.isTranslation=1);const{useFolderApi:C}=await R(async()=>{const{useFolderApi:I}=await import("./O9dB02R4.js");return{useFolderApi:I}},__vite__mapDeps([0,1,2,3]),import.meta.url);let x;F.value?x=await C.asyncExport(e):x=await C.asyncExportWithoutToken(e),[1,0].includes(((s=t.selectIds)==null?void 0:s.length)||0)&&u.value.length<=1&&!t.translateLang?await T([x]):(M({[x]:{num:(((l=t.selectIds)==null?void 0:l.length)||1)*(u.value.length||1)*(t.translateLang?2:1)}}),m.value=!1)}finally{i.value=!1}},{downloadFile:X}=ee(),T=async r=>{i.value=!0;const{useFolderApi:a}=await R(async()=>{const{useFolderApi:l}=await import("./O9dB02R4.js");return{useFolderApi:l}},__vite__mapDeps([0,1,2,3]),import.meta.url);let s;if(F.value?s=await a.asyncExportStatus({exportTaskIdList:r}):s=await a.asyncExportStatusWithOutToken({exportTaskIdList:r,userId:String(h.query.shareId)}),s.length)for(const l of s){if(l.status.toString()==="-1"){B.error({message:n("HomePage.export.error"),customClass:"!z-[9999]"}),i.value=!1;return}l.targetUrl&&(X(l.targetUrl),i.value=!1,m.value=!1)}E=setTimeout(()=>{T(r)},3e3)};return(r,a)=>{const s=le,l=te,c=se,v=ae;return g(),V("div",ne,[_(v,{modelValue:m.value,"onUpdate:modelValue":a[3]||(a[3]=e=>m.value=e),title:o(n)("FolderPage.dialog.export.title"),"close-on-click-modal":!1,"close-on-press-escape":!1,"destroy-on-close":!0,width:"30%",onClosed:N},{footer:p(()=>[_(c,{onClick:a[2]||(a[2]=e=>m.value=!1)},{default:p(()=>[A(k(o(n)("FolderPage.dialog.move.cancel")),1)]),_:1}),_(c,{loading:o(i),onClick:W,type:"primary"},{default:p(()=>[A(k(o(n)("FolderPage.dialog.export.confirm")),1)]),_:1},8,["loading"])]),default:p(()=>[b("div",re,[b("div",ue,k(o(n)("FolderPage.dialog.export.select")),1),_(l,{modelValue:o(u),"onUpdate:modelValue":a[0]||(a[0]=e=>w(u)?u.value=e:null)},{default:p(()=>[(g(!0),V(S,null,D(o(j),e=>(g(),L(s,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),b("div",null,[b("div",ie,k(o(n)("FolderPage.dialog.export.settings")),1),_(l,{modelValue:o(d),"onUpdate:modelValue":a[1]||(a[1]=e=>w(d)?d.value=e:null)},{default:p(()=>[(g(!0),V(S,null,D(o(z),e=>(g(),L(s,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),_:1},8,["modelValue","title"])])}}}),pe=oe(de,[["__scopeId","data-v-ae2aaeee"]]);export{pe as _};
