import{cd as tt}from"./DjTJqZtn.js";function we(t,n){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);n&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,i)}return r}function Y(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?we(Object(r),!0).forEach(function(i){S(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):we(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}function x(t){"@babel/helpers - typeof";return x=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},x(t)}function F(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function xe(t,n){for(var r=0;r<n.length;r++){var i=n[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,nt(i.key),i)}}function U(t,n,r){return n&&xe(t.prototype,n),r&&xe(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function S(t,n,r){return n=nt(n),n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}function ne(t,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),n&&ye(t,n)}function C(t){return C=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},C(t)}function ye(t,n){return ye=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,e){return i.__proto__=e,i},ye(t,n)}function pt(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function w(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function mt(t,n){if(n&&(typeof n=="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return w(t)}function ie(t){var n=pt();return function(){var i=C(t),e;if(n){var a=C(this).constructor;e=Reflect.construct(i,arguments,a)}else e=i.apply(this,arguments);return mt(this,e)}}function yt(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&(t=C(t),t!==null););return t}function N(){return typeof Reflect<"u"&&Reflect.get?N=Reflect.get.bind():N=function(n,r,i){var e=yt(n,r);if(e){var a=Object.getOwnPropertyDescriptor(e,r);return a.get?a.get.call(arguments.length<3?n:i):a.value}},N.apply(this,arguments)}function rt(t){return _t(t)||bt(t)||Tt(t)||Et()}function _t(t){if(Array.isArray(t))return _e(t)}function bt(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Tt(t,n){if(t){if(typeof t=="string")return _e(t,n);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return _e(t,n)}}function _e(t,n){(n==null||n>t.length)&&(n=t.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=t[r];return i}function Et(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ot(t,n){if(typeof t!="object"||t===null)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var i=r.call(t,n);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(t)}function nt(t){var n=Ot(t,"string");return typeof n=="symbol"?n:String(n)}var se={exports:{}},Ie;function St(){return Ie||(Ie=1,function(t){var n=Object.prototype.hasOwnProperty,r="~";function i(){}Object.create&&(i.prototype=Object.create(null),new i().__proto__||(r=!1));function e(u,l,c){this.fn=u,this.context=l,this.once=c||!1}function a(u,l,c,f,v){if(typeof c!="function")throw new TypeError("The listener must be a function");var d=new e(c,f||u,v),g=r?r+l:l;return u._events[g]?u._events[g].fn?u._events[g]=[u._events[g],d]:u._events[g].push(d):(u._events[g]=d,u._eventsCount++),u}function s(u,l){--u._eventsCount===0?u._events=new i:delete u._events[l]}function o(){this._events=new i,this._eventsCount=0}o.prototype.eventNames=function(){var l=[],c,f;if(this._eventsCount===0)return l;for(f in c=this._events)n.call(c,f)&&l.push(r?f.slice(1):f);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(c)):l},o.prototype.listeners=function(l){var c=r?r+l:l,f=this._events[c];if(!f)return[];if(f.fn)return[f.fn];for(var v=0,d=f.length,g=new Array(d);v<d;v++)g[v]=f[v].fn;return g},o.prototype.listenerCount=function(l){var c=r?r+l:l,f=this._events[c];return f?f.fn?1:f.length:0},o.prototype.emit=function(l,c,f,v,d,g){var m=r?r+l:l;if(!this._events[m])return!1;var p=this._events[m],y=arguments.length,b,_;if(p.fn){switch(p.once&&this.removeListener(l,p.fn,void 0,!0),y){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,c),!0;case 3:return p.fn.call(p.context,c,f),!0;case 4:return p.fn.call(p.context,c,f,v),!0;case 5:return p.fn.call(p.context,c,f,v,d),!0;case 6:return p.fn.call(p.context,c,f,v,d,g),!0}for(_=1,b=new Array(y-1);_<y;_++)b[_-1]=arguments[_];p.fn.apply(p.context,b)}else{var O=p.length,E;for(_=0;_<O;_++)switch(p[_].once&&this.removeListener(l,p[_].fn,void 0,!0),y){case 1:p[_].fn.call(p[_].context);break;case 2:p[_].fn.call(p[_].context,c);break;case 3:p[_].fn.call(p[_].context,c,f);break;case 4:p[_].fn.call(p[_].context,c,f,v);break;default:if(!b)for(E=1,b=new Array(y-1);E<y;E++)b[E-1]=arguments[E];p[_].fn.apply(p[_].context,b)}}return!0},o.prototype.on=function(l,c,f){return a(this,l,c,f,!1)},o.prototype.once=function(l,c,f){return a(this,l,c,f,!0)},o.prototype.removeListener=function(l,c,f,v){var d=r?r+l:l;if(!this._events[d])return this;if(!c)return s(this,d),this;var g=this._events[d];if(g.fn)g.fn===c&&(!v||g.once)&&(!f||g.context===f)&&s(this,d);else{for(var m=0,p=[],y=g.length;m<y;m++)(g[m].fn!==c||v&&!g[m].once||f&&g[m].context!==f)&&p.push(g[m]);p.length?this._events[d]=p.length===1?p[0]:p:s(this,d)}return this},o.prototype.removeAllListeners=function(l){var c;return l?(c=r?r+l:l,this._events[c]&&s(this,c)):(this._events=new i,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=r,o.EventEmitter=o,t.exports=o}(se)),se.exports}var wt=St();const it=tt(wt);var xt=typeof window<"u"&&window.location&&window.location.href.indexOf("xgplayerdebugger=1")>-1,oe={info:"color: #525252; background-color: #90ee90;",error:"color: #525252; background-color: red;",warn:"color: #525252; background-color: yellow; "},ue="%c[xgplayer]",A={config:{debug:xt?3:0},logInfo:function(n){for(var r,i=arguments.length,e=new Array(i>1?i-1:0),a=1;a<i;a++)e[a-1]=arguments[a];this.config.debug>=3&&(r=console).log.apply(r,[ue,oe.info,n].concat(e))},logWarn:function(n){for(var r,i=arguments.length,e=new Array(i>1?i-1:0),a=1;a<i;a++)e[a-1]=arguments[a];this.config.debug>=1&&(r=console).warn.apply(r,[ue,oe.warn,n].concat(e))},logError:function(n){var r;if(!(this.config.debug<1)){for(var i=this.config.debug>=2?"trace":"error",e=arguments.length,a=new Array(e>1?e-1:0),s=1;s<e;s++)a[s-1]=arguments[s];(r=console)[i].apply(r,[ue,oe.error,n].concat(a))}}};function _n(t){t.logInfo=A.logInfo.bind(t),t.logWarn=A.logWarn.bind(t),t.logError=A.logError.bind(t)}var It=function(){function t(n){F(this,t),this.bufferedList=n}return U(t,[{key:"start",value:function(r){return this.bufferedList[r].start}},{key:"end",value:function(r){return this.bufferedList[r].end}},{key:"length",get:function(){return this.bufferedList.length}}]),t}(),h={};h.createDom=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"div",n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"",e=document.createElement(t);return e.className=i,e.innerHTML=n,Object.keys(r).forEach(function(a){var s=a,o=r[a];t==="video"||t==="audio"||t==="live-video"?o&&e.setAttribute(s,o):e.setAttribute(s,o)}),e};h.createDomFromHtml=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";try{var i=document.createElement("div");i.innerHTML=t;var e=i.children;return i=null,e.length>0?(e=e[0],r&&h.addClass(e,r),n&&Object.keys(n).forEach(function(a){e.setAttribute(a,n[a])}),e):null}catch(a){return A.logError("util.createDomFromHtml",a),null}};h.hasClass=function(t,n){if(!t||!n)return!1;try{return Array.prototype.some.call(t.classList,function(i){return i===n})}catch{var r=t.className&&x(t.className)==="object"?t.getAttribute("class"):t.className;return r&&!!r.match(new RegExp("(\\s|^)"+n+"(\\s|$)"))}};h.addClass=function(t,n){if(!(!t||!n))try{n.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach(function(r){r&&t.classList.add(r)})}catch{h.hasClass(t,n)||(t.className&&x(t.className)==="object"?t.setAttribute("class",t.getAttribute("class")+" "+n):t.className+=" "+n)}};h.removeClass=function(t,n){if(!(!t||!n))try{n.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach(function(r){r&&t.classList.remove(r)})}catch{h.hasClass(t,n)&&n.split(/\s+/g).forEach(function(i){var e=new RegExp("(\\s|^)"+i+"(\\s|$)");t.className&&x(t.className)==="object"?t.setAttribute("class",t.getAttribute("class").replace(e," ")):t.className=t.className.replace(e," ")})}};h.toggleClass=function(t,n){t&&n.split(/\s+/g).forEach(function(r){h.hasClass(t,r)?h.removeClass(t,r):h.addClass(t,r)})};h.classNames=function(){for(var t=arguments,n=[],r=function(a){h.typeOf(t[a])==="String"?n.push(t[a]):h.typeOf(t[a])==="Object"&&Object.keys(t[a]).map(function(s){t[a][s]&&n.push(s)})},i=0;i<arguments.length;i++)r(i);return n.join(" ")};h.findDom=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:document,n=arguments.length>1?arguments[1]:void 0,r;try{r=t.querySelector(n)}catch(i){A.logError("util.findDom",i),n.indexOf("#")===0&&(r=t.getElementById(n.slice(1)))}return r};h.getCss=function(t,n){return t.currentStyle?t.currentStyle[n]:document.defaultView.getComputedStyle(t,!1)[n]};h.padStart=function(t,n,r){for(var i=String(r),e=n>>0,a=Math.ceil(e/i.length),s=[],o=String(t);a--;)s.push(i);return s.join("").substring(0,e-o.length)+o};h.format=function(t){if(window.isNaN(t))return"";t=Math.round(t);var n=h.padStart(Math.floor(t/3600),2,0),r=h.padStart(Math.floor((t-n*3600)/60),2,0),i=h.padStart(Math.floor(t-n*3600-r*60),2,0);return(n==="00"?[r,i]:[n,r,i]).join(":")};h.event=function(t){if(t.touches){var n=t.touches[0]||t.changedTouches[0];t.clientX=n.clientX||0,t.clientY=n.clientY||0,t.offsetX=n.pageX-n.target.offsetLeft,t.offsetY=n.pageY-n.target.offsetTop}t._target=t.target||t.srcElement};h.typeOf=function(t){return Object.prototype.toString.call(t).match(/([^\s.*]+)(?=]$)/g)[0]};h.deepCopy=function(t,n){if(h.typeOf(n)==="Object"&&h.typeOf(t)==="Object")return Object.keys(n).forEach(function(r){h.typeOf(n[r])==="Object"&&!(n[r]instanceof Node)?t[r]===void 0||t[r]===void 0?t[r]=n[r]:h.deepCopy(t[r],n[r]):h.typeOf(n[r])==="Array"?t[r]=h.typeOf(t[r])==="Array"?t[r].concat(n[r]):n[r]:t[r]=n[r]}),t};h.deepMerge=function(t,n){return Object.keys(n).map(function(r){if(h.typeOf(n[r])==="Array"&&h.typeOf(t[r])==="Array"){if(h.typeOf(t[r])==="Array"){var i;(i=t[r]).push.apply(i,rt(n[r]))}}else h.typeOf(t[r])===h.typeOf(n[r])&&t[r]!==null&&h.typeOf(t[r])==="Object"&&!(n[r]instanceof window.Node)?h.deepMerge(t[r],n[r]):n[r]!==null&&(t[r]=n[r])}),t};h.getBgImage=function(t){var n=(t.currentStyle||window.getComputedStyle(t,null)).backgroundImage;if(!n||n==="none")return"";var r=document.createElement("a");return r.href=n.replace(/url\("|"\)/g,""),r.href};h.copyDom=function(t){if(t&&t.nodeType===1){var n=document.createElement(t.tagName);return Array.prototype.forEach.call(t.attributes,function(r){n.setAttribute(r.name,r.value)}),t.innerHTML&&(n.innerHTML=t.innerHTML),n}else return""};h.setInterval=function(t,n,r,i){t._interval[n]||(t._interval[n]=window.setInterval(r.bind(t),i))};h.clearInterval=function(t,n){clearInterval(t._interval[n]),t._interval[n]=null};h.setTimeout=function(t,n,r){t._timers||(t._timers=[]);var i=setTimeout(function(){n(),h.clearTimeout(t,i)},r);return t._timers.push(i),i};h.clearTimeout=function(t,n){var r=t._timers;if(h.typeOf(r)==="Array"){for(var i=0;i<r.length;i++)if(r[i]===n){r.splice(i,1),clearTimeout(n);break}}else clearTimeout(n)};h.clearAllTimers=function(t){var n=t._timers;h.typeOf(n)==="Array"&&(n.map(function(r){clearTimeout(r)}),t._timerIds=[])};h.createImgBtn=function(t,n,r,i){var e=h.createDom("xg-".concat(t),"",{},"xgplayer-".concat(t,"-img"));if(e.style.backgroundImage='url("'.concat(n,'")'),r&&i){var a,s,o;["px","rem","em","pt","dp","vw","vh","vm","%"].every(function(u){return r.indexOf(u)>-1&&i.indexOf(u)>-1?(a=parseFloat(r.slice(0,r.indexOf(u)).trim()),s=parseFloat(i.slice(0,i.indexOf(u)).trim()),o=u,!1):!0}),e.style.width="".concat(a).concat(o),e.style.height="".concat(s).concat(o),e.style.backgroundSize="".concat(a).concat(o," ").concat(s).concat(o),t==="start"?e.style.margin="-".concat(s/2).concat(o," auto auto -").concat(a/2).concat(o):e.style.margin="auto 5px auto 5px"}return e};h.Hex2RGBA=function(t,n){var r=[];if(/^\#[0-9A-F]{3}$/i.test(t)){var i="#";t.replace(/[0-9A-F]/ig,function(e){i+=e+e}),t=i}return/^#[0-9A-F]{6}$/i.test(t)?(t.replace(/[0-9A-F]{2}/ig,function(e){r.push(parseInt(e,16))}),"rgba(".concat(r.join(","),", ").concat(n,")")):"rgba(255, 255, 255, 0.1)"};h.getFullScreenEl=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement};h.checkIsFunction=function(t){return t&&typeof t=="function"};h.checkIsObject=function(t){return t!==null&&x(t)==="object"};h.hide=function(t){t.style.display="none"};h.show=function(t,n){t.style.display=n||"block"};h.isUndefined=function(t){if(typeof t>"u"||t===null)return!0};h.isNotNull=function(t){return t!=null};h.setStyleFromCsstext=function(t,n){if(n)if(h.typeOf(n)==="String"){var r=n.replace(/\s+/g,"").split(";");r.map(function(i){if(i){var e=i.split(":");e.length>1&&(t.style[e[0]]=e[1])}})}else Object.keys(n).map(function(i){t.style[i]=n[i]})};function Ct(t,n){for(var r=0,i=n.length;r<i;r++)if(t.indexOf(n[r])>-1)return!0;return!1}h.filterStyleFromText=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["width","height","top","left","bottom","right","position","z-index","padding","margin","transform"],r=t.style.cssText;if(!r)return{};var i=r.replace(/\s+/g,"").split(";"),e={},a={};return i.map(function(s){if(s){var o=s.split(":");o.length>1&&(Ct(o[0],n)?e[o[0]]=o[1]:a[o[0]]=o[1])}}),t.setAttribute("style",""),Object.keys(a).map(function(s){t.style[s]=a[s]}),e};h.getStyleFromCsstext=function(t){var n=t.style.cssText;if(!n)return{};var r=n.replace(/\s+/g,"").split(";"),i={};return r.map(function(e){if(e){var a=e.split(":");a.length>1&&(i[a[0]]=a[1])}}),i};h.preloadImg=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:function(){},r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:function(){};if(t){var i=new window.Image;i.onload=function(e){i=null,n&&n(e)},i.onerror=function(e){i=null,r&&r(e)},i.src=t}};h.stopPropagation=function(t){t&&t.stopPropagation()};h.scrollTop=function(){return window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0};h.scrollLeft=function(){return window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0};h.checkTouchSupport=function(){return"ontouchstart"in window};h.getBuffered2=function(t){for(var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:.5,r=[],i=0;i<t.length;i++)r.push({start:t.start(i)<.5?0:t.start(i),end:t.end(i)});r.sort(function(u,l){var c=u.start-l.start;return c||l.end-u.end});var e=[];if(n)for(var a=0;a<r.length;a++){var s=e.length;if(s){var o=e[s-1].end;r[a].start-o<n?r[a].end>o&&(e[s-1].end=r[a].end):e.push(r[a])}else e.push(r[a])}else e=r;return new It(e)};h.getEventPos=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return t.touches&&t.touches.length>0&&(t=t.touches[0]),{x:t.x/n,y:t.y/n,clientX:t.clientX/n,clientY:t.clientY/n,offsetX:t.offsetX/n,offsetY:t.offsetY/n,pageX:t.pageX/n,pageY:t.pageY/n}};h.requestAnimationFrame=function(t){var n=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;if(n)return n(t)};h.getHostFromUrl=function(t){if(h.typeOf(t)!=="String")return"";var n=t.split("/"),r="";return n.length>3&&n[2]&&(r=n[2]),r};h.cancelAnimationFrame=function(t){var n=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.cancelRequestAnimationFrame;n&&n(t)};h.isMSE=function(t){return t.media&&(t=t.media),!t||!(t instanceof HTMLMediaElement)?!1:/^blob/.test(t.currentSrc)||/^blob/.test(t.src)};h.isBlob=function(t){return typeof t=="string"&&/^blob/.test(t)};h.generateSessionId=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=new Date().getTime();try{t=parseInt(t)}catch{t=0}n+=t,window.performance&&typeof window.performance.now=="function"&&(n+=parseInt(window.performance.now()));var r="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){var e=(n+Math.random()*16)%16|0;return n=Math.floor(n/16),(i==="x"?e:e&3|8).toString(16)});return r};h.createEvent=function(t){var n;return typeof window.Event=="function"?n=new Event(t):(n=document.createEvent("Event"),n.initEvent(t,!0,!0)),n};h.adjustTimeByDuration=function(t,n,r){return!n||!t?t:t>n||r&&t<n?n:t};h.createPositionBar=function(t,n){var r=h.createDom("xg-bar","",{"data-index":-1},t);return n.appendChild(r),r};h.getTransformStyle=function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{x:0,y:0,scale:1,rotate:0},n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",r={scale:"".concat(t.scale||1),translate:"".concat(t.x||0,"%, ").concat(t.y||0,"%"),rotate:"".concat(t.rotate||0,"deg")},i=Object.keys(r);return i.forEach(function(e){var a=new RegExp("".concat(e,"\\([^\\(]+\\)"),"g"),s="".concat(e,"(").concat(r[e],")");a.test(n)?(a.lastIndex=-1,n=n.replace(a,s)):n+="".concat(s," ")}),n};h.convertDeg=function(t){return Math.abs(t)<=1?t*360:t%360};h.getIndexByTime=function(t,n){var r=n.length,i=-1;if(r<1)return i;if(t<=n[0].end||r<2)i=0;else if(t>n[r-1].end)i=r-1;else for(var e=1;e<r;e++)if(t>n[e-1].end&&t<=n[e].end){i=e;break}return i};h.getOffsetCurrentTime=function(t,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:-1,i=-1;if(r>=0&&r<n.length?i=r:i=h.getIndexByTime(t,n),i<0)return-1;var e=n.length,a=n[i],s=a.start,o=a.end,u=a.cTime,l=a.offset;return t<s?u:t>=s&&t<=o?t-l:t>o&&i>=e-1?o:-1};h.getCurrentTimeByOffset=function(t,n){var r=-1;if(!n||n.length<0)return t;for(var i=0;i<n.length;i++)if(t<=n[i].duration){r=i;break}if(r!==-1){var e=n[r].start;return r-1<0?e+t:e+(t-n[r-1].duration)}return t};function at(t){var n=x(t);return t!==null&&(n==="object"||n==="function")}function At(t,n,r){var i,e,a,s,o,u,l=0,c=!1,f=!1,v=!0,d=!n&&n!==0&&typeof window.requestAnimationFrame=="function";if(typeof t!="function")throw new TypeError("Expected a function");n=+n||0,at(r)&&(c=!!r.leading,f="maxWait"in r,a=f?Math.max(+r.maxWait||0,n):a,v="trailing"in r?!!r.trailing:v);function g(T){var L=i,D=e;return i=e=void 0,l=T,s=t.apply(D,L),s}function m(T,L){return d?(window.cancelAnimationFrame(o),window.requestAnimationFrame(T)):setTimeout(T,L)}function p(T){if(d)return window.cancelAnimationFrame(T);clearTimeout(T)}function y(T){return l=T,o=m(O,n),c?g(T):s}function b(T){var L=T-u,D=T-l,W=n-L;return f?Math.min(W,a-D):W}function _(T){var L=T-u,D=T-l;return u===void 0||L>=n||L<0||f&&D>=a}function O(){var T=Date.now();if(_(T))return E(T);o=m(O,b(T))}function E(T){return o=void 0,v&&i?g(T):(i=e=void 0,s)}function G(){o!==void 0&&p(o),l=0,i=u=e=o=void 0}function V(){return o===void 0?s:E(Date.now())}function J(){return o!==void 0}function Q(){for(var T=Date.now(),L=_(T),D=arguments.length,W=new Array(D),ee=0;ee<D;ee++)W[ee]=arguments[ee];if(i=W,e=this,u=T,L){if(o===void 0)return y(u);if(f)return o=m(O,n),g(u)}return o===void 0&&(o=m(O,n)),s}return Q.cancel=G,Q.flush=V,Q.pending=J,Q}function bn(t,n,r){var i=!0,e=!0;if(typeof t!="function")throw new TypeError("Expected a function");return at(r)&&(i="leading"in r?!!r.leading:i,e="trailing"in r?!!r.trailing:e),At(t,n,{leading:i,trailing:e,maxWait:n})}function Tn(){var t=(document.documentElement.getAttribute("lang")||navigator.language||"zh-cn").toLocaleLowerCase();return t==="zh-cn"&&(t="zh"),t}function En(t,n,r){if(t){var i=t.getAttribute(r);return!!(i&&i===n&&(t.tagName==="VIDEO"||t.tagName==="AUDIO"))}}var Ce={android:/(Android)\s([\d.]+)/,ios:/(Version)\/([\d.]+)/},Lt=["avc1.42E01E, mp4a.40.2","avc1.58A01E, mp4a.40.2","avc1.4D401E, mp4a.40.2","avc1.64001E, mp4a.40.2","avc1.42E01E","mp4v.20.8","mp4v.20.8, mp4a.40.2","mp4v.20.240, mp4a.40.2"],Ee={get device(){var t=Ee.os;return t.isPc?"pc":"mobile"},get browser(){if(typeof navigator>"u")return"";var t=navigator.userAgent.toLowerCase(),n={ie:/rv:([\d.]+)\) like gecko/,firefox:/firefox\/([\d.]+)/,chrome:/chrome\/([\d.]+)/,opera:/opera.([\d.]+)/,safari:/version\/([\d.]+).*safari/};return[].concat(Object.keys(n).filter(function(r){return n[r].test(t)}))[0]},get os(){if(typeof navigator>"u")return{};var t=navigator.userAgent,n=/(?:Windows Phone)/.test(t),r=/(?:SymbianOS)/.test(t)||n,i=/(?:Tizen)/ig.test(t),e=/(?:Web0S)/ig.test(t),a=/(?:Android)/.test(t),s=/(?:Firefox)/.test(t),o=/(?:iPad|PlayBook)/.test(t)||navigator.platform==="MacIntel"&&navigator.maxTouchPoints>1,u=o||a&&!/(?:Mobile)/.test(t)||s&&/(?:Tablet)/.test(t),l=/(?:iPhone)/.test(t)&&!u,c=!l&&!a&&!r&&!u;return{isTablet:u,isPhone:l,isIpad:o,isIos:l||o,isAndroid:a,isPc:c,isSymbian:r,isWindowsPhone:n,isFireFox:s,isTizen:i,isWebOS:e}},get osVersion(){if(typeof navigator>"u")return 0;var t=navigator.userAgent,n="";/(?:iPhone)|(?:iPad|PlayBook)/.test(t)?n=Ce.ios:n=Ce.android;var r=n?n.exec(t):[];if(r&&r.length>=3){var i=r[2].split(".");return i.length>0?parseInt(i[0]):0}return 0},get isWeixin(){if(typeof navigator>"u")return!1;var t=/(micromessenger)\/([\d.]+)/,n=t.exec(navigator.userAgent.toLocaleLowerCase());return!!n},isSupportMP4:function(){var n={isSupport:!1,mime:""};if(typeof document>"u")return n;if(this.supportResult)return this.supportResult;var r=document.createElement("video");return typeof r.canPlayType=="function"&&Lt.map(function(i){r.canPlayType('video/mp4; codecs="'.concat(i,'"'))==="probably"&&(n.isSupport=!0,n.mime+="||".concat(i))}),this.supportResult=n,r=null,n},isMSESupport:function(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:'video/mp4; codecs="avc1.42E01E,mp4a.40.2"';if(typeof MediaSource>"u"||!MediaSource)return!1;try{return MediaSource.isTypeSupported(n)}catch(r){return this._logger.error(n,r),!1}},isHevcSupported:function(){return typeof MediaSource>"u"||!MediaSource.isTypeSupported?!1:MediaSource.isTypeSupported('video/mp4;codecs="hev1.1.6.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.2.4.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.3.E.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.4.10.L120.90"')},probeConfigSupported:function(n){var r={supported:!1,smooth:!1,powerEfficient:!1};if(!n||typeof navigator>"u")return Promise.resolve(r);if(navigator.mediaCapabilities&&navigator.mediaCapabilities.decodingInfo)return navigator.mediaCapabilities.decodingInfo(n);var i=n.video||{},e=n.audio||{};try{var a=MediaSource.isTypeSupported(i.contentType),s=MediaSource.isTypeSupported(e.contentType);return Promise.resolve({supported:a&&s,smooth:!1,powerEfficient:!1})}catch{return Promise.resolve(r)}}},kt="play",Rt="playing",Pt="ended",Nt="pause",Dt="error",Mt="seeking",jt="seeked",Ht="timeupdate",Bt="waiting",st="canplay",Ft="canplaythrough",Ut="durationchange",$t="volumechange",zt="loadeddata",Gt="loadedmetadata",Vt="ratechange",Wt="progress",Yt="loadstart",Xt="emptied",Kt="stalled",qt="suspend",Zt="abort",Jt="bufferedChange",Oe="focus",ot="blur",Qt="ready",er="urlNull",tr="autoplay_started",rr="autoplay_was_prevented",nr="complete",ir="replay",ar="destroy",sr="urlchange",or="download_speed_change",ur="leaveplayer",lr="enterplayer",cr="loading",ut="fullscreen_change",fr="cssFullscreen_change",hr="mini_state_change",gr="definition_change",vr="before_definition_change",dr="after_definition_change",pr="SEI_PARSED",mr="retry",lt="video_resize",yr="pip_change",_r="rotate",br="screenShot",Tr="playnext",Er="shortcut",Or="xglog",Sr="user_action",wr="reset",xr="source_error",Ir="source_success",Cr="switch_subtitle",Ar=["play","playing","ended","pause","error","seeking","seeked","timeupdate","waiting","canplay","canplaythrough","durationchange","volumechange","loadeddata","loadedmetadata","ratechange","progress","loadstart","emptied","stalled","suspend","abort","lowdecode"],Lr={STATS_INFO:"stats_info",STATS_DOWNLOAD:"stats_download",STATS_RESET:"stats_reset"},kr="fps_stuck";const On=Object.freeze(Object.defineProperty({__proto__:null,ABORT:Zt,AFTER_DEFINITION_CHANGE:dr,AUTOPLAY_PREVENTED:rr,AUTOPLAY_STARTED:tr,BEFORE_DEFINITION_CHANGE:vr,BUFFER_CHANGE:Jt,CANPLAY:st,CANPLAY_THROUGH:Ft,COMPLETE:nr,CSS_FULLSCREEN_CHANGE:fr,DEFINITION_CHANGE:gr,DESTROY:ar,DOWNLOAD_SPEED_CHANGE:or,DURATION_CHANGE:Ut,EMPTIED:Xt,ENDED:Pt,ENTER_PLAYER:lr,ERROR:Dt,FPS_STUCK:kr,FULLSCREEN_CHANGE:ut,LEAVE_PLAYER:ur,LOADED_DATA:zt,LOADED_METADATA:Gt,LOADING:cr,LOAD_START:Yt,MINI_STATE_CHANGE:hr,PAUSE:Nt,PIP_CHANGE:yr,PLAY:kt,PLAYER_BLUR:ot,PLAYER_FOCUS:Oe,PLAYING:Rt,PLAYNEXT:Tr,PROGRESS:Wt,RATE_CHANGE:Vt,READY:Qt,REPLAY:ir,RESET:wr,RETRY:mr,ROTATE:_r,SCREEN_SHOT:br,SEEKED:jt,SEEKING:Mt,SEI_PARSED:pr,SHORTCUT:Er,SOURCE_ERROR:xr,SOURCE_SUCCESS:Ir,STALLED:Kt,STATS_EVENTS:Lr,SUSPEND:qt,SWITCH_SUBTITLE:Cr,TIME_UPDATE:Ht,URL_CHANGE:sr,URL_NULL:er,USER_ACTION:Sr,VIDEO_EVENTS:Ar,VIDEO_RESIZE:lt,VOLUME_CHANGE:$t,WAITING:Bt,XGLOG:Or},Symbol.toStringTag,{value:"Module"}));function te(t,n,r){for(var i=arguments.length,e=new Array(i>3?i-3:0),a=3;a<i;a++)e[a-3]=arguments[a];var s=n.call.apply(n,[t].concat(e));!r||typeof r!="function"||(s&&s.then?s.then(function(){for(var o=arguments.length,u=new Array(o),l=0;l<o;l++)u[l]=arguments[l];r.call.apply(r,[t].concat(u))}):r.call.apply(r,[t].concat(e)))}function Ae(t,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{pre:null,next:null};return this.__hooks||(this.__hooks={}),!this.__hooks[t]&&(this.__hooks[t]=null),(function(){var i=arguments,e=this;if(r.pre)try{var a;(a=r.pre).call.apply(a,[this].concat(Array.prototype.slice.call(arguments)))}catch(o){throw o.message="[pluginName: ".concat(this.pluginName,":").concat(t,":pre error] >> ").concat(o.message),o}if(this.__hooks&&this.__hooks[t])try{var s=Nr(this,t,n);s?s.then?s.then(function(o){o!==!1&&te.apply(void 0,[e,n,r.next].concat(rt(i)))}).catch(function(o){throw o}):te.apply(void 0,[this,n,r.next].concat(Array.prototype.slice.call(arguments))):s===void 0&&te.apply(void 0,[this,n,r.next].concat(Array.prototype.slice.call(arguments)))}catch(o){throw o.message="[pluginName: ".concat(this.pluginName,":").concat(t,"] >> ").concat(o.message),o}else te.apply(void 0,[this,n,r.next].concat(Array.prototype.slice.call(arguments)))}).bind(this)}function ct(t,n){var r=this.__hooks;if(!r||!Array.isArray(r[t]))return-1;for(var i=r[t],e=0;e<i.length;e++)if(i[e]===n)return e;return-1}function Le(t,n){var r=this.__hooks;if(r)return r.hasOwnProperty(t)?(Array.isArray(r[t])||(r[t]=[]),ct.call(this,t,n)===-1&&r[t].push(n),!0):(console.warn("has no supported hook which name [".concat(t,"]")),!1)}function ke(t,n){var r=this.__hooks;if(r)if(Array.isArray(r[t])){var i=r[t],e=ct.call(this,t,n);e!==-1&&i.splice(e,1)}else r[t]&&(r[t]=null)}function Sn(t){if(!(!this.plugins||!this.plugins[t.toLowerCase()])){for(var n=this.plugins[t.toLowerCase()],r=arguments.length,i=new Array(r>1?r-1:0),e=1;e<r;e++)i[e-1]=arguments[e];return n.useHooks&&n.useHooks.apply(n,i)}}function wn(t){if(!(!this.plugins||!this.plugins[t.toLowerCase()])){var n=this.plugins[t.toLowerCase()];if(n){for(var r=arguments.length,i=new Array(r>1?r-1:0),e=1;e<r;e++)i[e-1]=arguments[e];return n.removeHooks&&n.removeHooks.apply(n,i)}}}function Rr(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];t.__hooks={},n&&n.map(function(r){t.__hooks[r]=null}),Object.defineProperty(t,"hooks",{get:function(){return t.__hooks&&Object.keys(t.__hooks).map(function(i){if(t.__hooks[i])return i})}})}function Pr(t){t.__hooks=null}function Nr(t,n,r){for(var i=arguments.length,e=new Array(i>3?i-3:0),a=3;a<i;a++)e[a-3]=arguments[a];if(t.__hooks&&Array.isArray(t.__hooks[n])){var s=t.__hooks[n],o=-1,u=function l(c,f,v){for(var d=arguments.length,g=new Array(d>3?d-3:0),m=3;m<d;m++)g[m-3]=arguments[m];if(o++,s.length===0||o===s.length)return v.call.apply(v,[c,c].concat(g));var p=s[o],y=p.call.apply(p,[c,c].concat(g));if(y&&y.then)return y.then(function(b){return b===!1?null:l.apply(void 0,[c,f,v].concat(g))}).catch(function(b){console.warn("[runHooks]".concat(f," reject"),b.message)});if(y!==!1)return l.apply(void 0,[c,f,v].concat(g))};return u.apply(void 0,[t,n,r].concat(e))}else return r.call.apply(r,[t,t].concat(e))}function le(t,n){A.logError("[".concat(t,"] event or callback cant be undefined or null when call ").concat(n))}var Dr=function(){function t(n){F(this,t),h.checkIsFunction(this.beforeCreate)&&this.beforeCreate(n),Rr(this),this.__args=n,this.__events={},this.__onceEvents={},this.config=n.config||{},this.player=null,this.playerConfig={},this.pluginName="",this.__init(n)}return U(t,[{key:"beforeCreate",value:function(r){}},{key:"afterCreate",value:function(){}},{key:"beforePlayerInit",value:function(){}},{key:"onPluginsReady",value:function(){}},{key:"afterPlayerInit",value:function(){}},{key:"destroy",value:function(){}},{key:"__init",value:function(r){this.player=r.player,this.playerConfig=r.player&&r.player.config,this.pluginName=r.pluginName?r.pluginName.toLowerCase():this.constructor.pluginName.toLowerCase(),this.logger=r.player&&r.player.logger}},{key:"updateLang",value:function(r){r||(r=this.lang)}},{key:"lang",get:function(){return this.player.lang}},{key:"i18n",get:function(){return this.player.i18n}},{key:"i18nKeys",get:function(){return this.player.i18nKeys}},{key:"domEventType",get:function(){var r=h.checkTouchSupport()?"touch":"mouse";return this.playerConfig&&(this.playerConfig.domEventType==="touch"||this.playerConfig.domEventType==="mouse")&&(r=this.playerConfig.domEventType),r}},{key:"on",value:function(r,i){var e=this;if(!r||!i||!this.player){le(this.pluginName,"plugin.on(event, callback)");return}typeof r=="string"?(this.__events[r]=i,this.player.on(r,i)):Array.isArray(r)&&r.forEach(function(a){e.__events[a]=i,e.player.on(a,i)})}},{key:"once",value:function(r,i){var e=this;if(!r||!i||!this.player){le(this.pluginName,"plugin.once(event, callback)");return}typeof r=="string"?(this.__onceEvents[r]=i,this.player.once(r,i)):Array.isArray(r)&&r.forEach(function(a){e.__onceEvents[a]=i,e.player.once(r,i)})}},{key:"off",value:function(r,i){var e=this;if(!r||!i||!this.player){le(this.pluginName,"plugin.off(event, callback)");return}typeof r=="string"?(delete this.__events[r],this.player.off(r,i)):Array.isArray(r)&&r.forEach(function(a){delete e.__events[r],e.player.off(a,i)})}},{key:"offAll",value:function(){var r=this;["__events","__onceEvents"].forEach(function(i){Object.keys(r[i]).forEach(function(e){r[i][e]&&r.off(e,r[i][e]),e&&delete r[i][e]})}),this.__events={},this.__onceEvents={}}},{key:"emit",value:function(r){var i;if(this.player){for(var e=arguments.length,a=new Array(e>1?e-1:0),s=1;s<e;s++)a[s-1]=arguments[s];(i=this.player).emit.apply(i,[r].concat(a))}}},{key:"emitUserAction",value:function(r,i){var e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(this.player){var a=Y(Y({},e),{},{pluginName:this.pluginName});this.player.emitUserAction(r,i,a)}}},{key:"hook",value:function(r,i){return Ae.call.apply(Ae,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"useHooks",value:function(r,i){for(var e=arguments.length,a=new Array(e>2?e-2:0),s=2;s<e;s++)a[s-2]=arguments[s];return Le.call.apply(Le,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"removeHooks",value:function(r,i){for(var e=arguments.length,a=new Array(e>2?e-2:0),s=2;s<e;s++)a[s-2]=arguments[s];return ke.call.apply(ke,[this].concat(Array.prototype.slice.call(arguments)))}},{key:"registerPlugin",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";if(this.player)return e&&(i.pluginName=e),this.player.registerPlugin({plugin:r,options:i})}},{key:"getPlugin",value:function(r){return this.player?this.player.getPlugin(r):null}},{key:"__destroy",value:function(){var r=this,i=this.player,e=this.pluginName;this.offAll(),h.clearAllTimers(this),h.checkIsFunction(this.destroy)&&this.destroy(),["player","playerConfig","pluginName","logger","__args","__hooks"].map(function(a){r[a]=null}),i.unRegisterPlugin(e),Pr(this)}}],[{key:"defineGetterOrSetter",value:function(r,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&Object.defineProperty(r,e,i[e])}},{key:"defineMethod",value:function(r,i){for(var e in i)Object.prototype.hasOwnProperty.call(i,e)&&typeof i[e]=="function"&&Object.defineProperty(r,e,{configurable:!0,value:i[e]})}},{key:"defaultConfig",get:function(){return{}}},{key:"pluginName",get:function(){return"pluginName"}}]),t}(),ce,Re;function Mr(){if(Re)return ce;Re=1;var t=9;if(typeof Element<"u"&&!Element.prototype.matches){var n=Element.prototype;n.matches=n.matchesSelector||n.mozMatchesSelector||n.msMatchesSelector||n.oMatchesSelector||n.webkitMatchesSelector}function r(i,e){for(;i&&i.nodeType!==t;){if(typeof i.matches=="function"&&i.matches(e))return i;i=i.parentNode}}return ce=r,ce}var fe,Pe;function jr(){if(Pe)return fe;Pe=1;var t=Mr();function n(e,a,s,o,u){var l=i.apply(this,arguments);return e.addEventListener(s,l,u),{destroy:function(){e.removeEventListener(s,l,u)}}}function r(e,a,s,o,u){return typeof e.addEventListener=="function"?n.apply(null,arguments):typeof s=="function"?n.bind(null,document).apply(null,arguments):(typeof e=="string"&&(e=document.querySelectorAll(e)),Array.prototype.map.call(e,function(l){return n(l,a,s,o,u)}))}function i(e,a,s,o){return function(u){u.delegateTarget=t(u.target,a),u.delegateTarget&&o.call(e,u)}}return fe=r,fe}var Hr=jr();const Ne=tt(Hr);var Br={CONTROLS:"controls",ROOT:"root"},ae={ROOT:"root",ROOT_LEFT:"rootLeft",ROOT_RIGHT:"rootRight",ROOT_TOP:"rootTop",CONTROLS_LEFT:"controlsLeft",CONTROLS_RIGTH:"controlsRight",CONTROLS_RIGHT:"controlsRight",CONTROLS_CENTER:"controlsCenter",CONTROLS:"controls"},De={ICON_DISABLE:"xg-icon-disable"};function he(t){return t?t.indexOf&&/^(?:http|data:|\/)/.test(t):!1}function Fr(t,n){return x(t)==="object"&&t.class&&typeof t.class=="string"?"".concat(n," ").concat(t.class):n}function Ur(t,n){return x(t)==="object"&&t.attr&&x(t.attr)==="object"&&Object.keys(t.attr).map(function(r){n[r]=t.attr[r]}),n}function Me(t,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"",i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},e=arguments.length>4&&arguments[4]!==void 0?arguments[4]:"",a=null;if(t instanceof window.Element)return h.addClass(t,r),Object.keys(i).map(function(s){t.setAttribute(s,i[s])}),t;if(he(t)||he(t.url))return i.src=he(t)?t:t.url||"",a=h.createDom(t.tag||"img","",i,"xg-img ".concat(r)),a;if(typeof t=="function")try{return a=t(),a instanceof window.Element?(h.addClass(a,r),Object.keys(i).map(function(s){a.setAttribute(s,i[s])}),a):(A.logWarn("warn>>icons.".concat(n," in config of plugin named [").concat(e,"] is a function mast return an Element Object")),null)}catch(s){return A.logError("Plugin named [".concat(e,"]:createIcon"),s),null}return typeof t=="string"?h.createDomFromHtml(t,i,r):(A.logWarn("warn>>icons.".concat(n," in config of plugin named [").concat(e,"] is invalid")),null)}function $r(t,n){var r=n.config.icons||n.playerConfig.icons;Object.keys(t).map(function(i){var e=t[i],a=e&&e.class?e.class:"",s=e&&e.attr?e.attr:{},o=null;r&&r[i]&&(a=Fr(r[i],a),s=Ur(r[i],s),o=Me(r[i],i,a,s,n.pluginName)),!o&&e&&(o=Me(e.icon?e.icon:e,s,a,{},n.pluginName)),n.icons[i]=o})}function zr(t,n){Object.keys(t).map(function(r){Object.defineProperty(n.langText,r,{get:function(){var e=n.lang,a=n.i18n;return a[r]?a[r]:t[r]&&t[r][e]||""}})})}var ft=function(t){ne(r,t);var n=ie(r);function r(){var i,e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return F(this,r),i=n.call(this,e),i.__delegates=[],i}return U(r,[{key:"__init",value:function(e){if(N(C(r.prototype),"__init",this).call(this,e),!!e.root){var a=e.root,s=null;this.icons={},this.root=null,this.parent=null;var o=this.registerIcons()||{};$r(o,this),this.langText={};var u=this.registerLanguageTexts()||{};zr(u,this);var l="";try{l=this.render()}catch(v){throw A.logError("Plugin:".concat(this.pluginName,":render"),v),new Error("Plugin:".concat(this.pluginName,":render:").concat(v.message))}if(l)s=r.insert(l,a,e.index),s.setAttribute("data-index",e.index);else if(e.tag)s=h.createDom(e.tag,"",e.attr,e.name),s.setAttribute("data-index",e.index),a.appendChild(s);else return;this.root=s,this.parent=a;var c=this.config.attr||{},f=this.config.style||{};this.setAttr(c),this.setStyle(f),this.config.index&&this.root.setAttribute("data-index",this.config.index),this.__registerChildren()}}},{key:"__registerChildren",value:function(){var e=this;if(this.root){this._children=[];var a=this.children();a&&x(a)==="object"&&Object.keys(a).length>0&&Object.keys(a).map(function(s){var o=s,u=a[o],l={root:e.root},c,f;typeof u=="function"?(c=e.config[o]||{},f=u):x(u)==="object"&&typeof u.plugin=="function"&&(c=u.options?h.deepCopy(e.config[o]||{},u.options):e.config[o]||{},f=u.plugin),l.config=c,c.index!==void 0&&(l.index=c.index),c.root&&(l.root=c.root),e.registerPlugin(f,l,o)})}}},{key:"updateLang",value:function(e){e||(e=this.lang);function a(l,c){for(var f=0;f<l.children.length;f++)l.children[f].children.length>0?a(l.children[f],c):c(l.children[f])}var s=this.root,o=this.i18n,u=this.langText;s&&a(s,function(l){var c=l.getAttribute&&l.getAttribute("lang-key");if(c){var f=o[c.toUpperCase()]||u[c];f&&(l.innerHTML=typeof f=="function"?f(e):f)}})}},{key:"lang",get:function(){return this.player.lang}},{key:"changeLangTextKey",value:function(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",s=this.i18n||{},o=this.langText;e.setAttribute&&e.setAttribute("lang-key",a);var u=s[a]||o[a]||"";u&&(e.innerHTML=u)}},{key:"plugins",value:function(){return this._children}},{key:"disable",value:function(){this.config.disable=!0,h.addClass(this.find(".xgplayer-icon"),De.ICON_DISABLE)}},{key:"enable",value:function(){this.config.disable=!1,h.removeClass(this.find(".xgplayer-icon"),De.ICON_DISABLE)}},{key:"children",value:function(){return{}}},{key:"registerPlugin",value:function(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"";a.root=a.root||this.root;var o=N(C(r.prototype),"registerPlugin",this).call(this,e,a,s);return this._children.push(o),o}},{key:"registerIcons",value:function(){return{}}},{key:"registerLanguageTexts",value:function(){return{}}},{key:"find",value:function(e){if(this.root)return this.root.querySelector(e)}},{key:"bind",value:function(e,a,s){var o=this;if(arguments.length<3&&typeof a=="function")Array.isArray(e)?e.forEach(function(l){o.bindEL(l,a)}):this.bindEL(e,a);else{var u=r.delegate.call(this,this.root,e,a,s);this.__delegates=this.__delegates.concat(u)}}},{key:"unbind",value:function(e,a){var s=this;if(arguments.length<3&&typeof a=="function")Array.isArray(e)?e.forEach(function(l){s.unbindEL(l,a)}):this.unbindEL(e,a);else for(var o="".concat(e,"_").concat(a),u=0;u<this.__delegates.length;u++)if(this.__delegates[u].key===o){this.__delegates[u].destroy(),this.__delegates.splice(u,1);break}}},{key:"setStyle",value:function(e,a){var s=this;if(this.root){if(h.typeOf(e)==="String")return this.root.style[e]=a;h.typeOf(e)==="Object"&&Object.keys(e).map(function(o){s.root.style[o]=e[o]})}}},{key:"setAttr",value:function(e,a){var s=this;if(this.root){if(h.typeOf(e)==="String")return this.root.setAttribute(e,a);h.typeOf(e)==="Object"&&Object.keys(e).map(function(o){s.root.setAttribute(o,e[o])})}}},{key:"setHtml",value:function(e,a){this.root&&(this.root.innerHTML=e,typeof a=="function"&&a())}},{key:"bindEL",value:function(e,a){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.root&&"on".concat(e)in this.root&&typeof a=="function"&&this.root.addEventListener(e,a,s)}},{key:"unbindEL",value:function(e,a){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;this.root&&"on".concat(e)in this.root&&typeof a=="function"&&this.root.removeEventListener(e,a,s)}},{key:"show",value:function(e){if(this.root){this.root.style.display=e!==void 0?e:"block";var a=window.getComputedStyle(this.root,null),s=a.getPropertyValue("display");if(s==="none")return this.root.style.display="block"}}},{key:"hide",value:function(){this.root&&(this.root.style.display="none")}},{key:"appendChild",value:function(e,a){if(!this.root)return null;if(arguments.length<2&&arguments[0]instanceof window.Element)return this.root.appendChild(arguments[0]);if(!a||!(a instanceof window.Element))return null;try{return typeof e=="string"?this.find(e).appendChild(a):e.appendChild(a)}catch(s){return A.logError("Plugin:appendChild",s),null}}},{key:"render",value:function(){return""}},{key:"destroy",value:function(){}},{key:"__destroy",value:function(){var e=this,a=this.player;this.__delegates.map(function(s){s.destroy()}),this.__delegates=[],this._children instanceof Array&&(this._children.map(function(s){a.unRegisterPlugin(s.pluginName)}),this._children=null),this.root&&(this.root.hasOwnProperty("remove")?this.root.remove():this.root.parentNode&&this.root.parentNode.removeChild(this.root)),N(C(r.prototype),"__destroy",this).call(this),this.icons={},["root","parent"].map(function(s){e[s]=null})}}],[{key:"insert",value:function(e,a){var s=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,o=a.children.length,u=Number(s),l=e instanceof window.Node;if(o){for(var c=0,f=null,v="";c<o;c++){f=a.children[c];var d=Number(f.getAttribute("data-index"));if(d>=u){v="beforebegin";break}else d<u&&(v="afterend")}return l?v==="afterend"?a.appendChild(e):a.insertBefore(e,f):f.insertAdjacentHTML(v,e),v==="afterend"?a.children[a.children.length-1]:a.children[c]}else return l?a.appendChild(e):a.insertAdjacentHTML("beforeend",e),a.children[a.children.length-1]}},{key:"defaultConfig",get:function(){return{}}},{key:"delegate",value:function(e,a,s,o){var u=arguments.length>4&&arguments[4]!==void 0?arguments[4]:!1,l=[];if(e instanceof window.Node&&typeof o=="function")if(Array.isArray(s))s.forEach(function(f){var v=Ne(e,a,f,o,u);v.key="".concat(a,"_").concat(f),l.push(v)});else{var c=Ne(e,a,s,o,u);c.key="".concat(a,"_").concat(s),l.push(c)}return l}},{key:"ROOT_TYPES",get:function(){return Br}},{key:"POSITIONS",get:function(){return ae}}]),r}(Dr),Gr=function(){function t(n){F(this,t),this.config=n.config,this.parent=n.root,this.root=h.createDom("ul","",{},"xg-options-list xg-list-slide-scroll ".concat(this.config.className)),n.root.appendChild(this.root);var r=this.config.maxHeight;r&&this.setStyle({maxHeight:r}),this.onItemClick=this.onItemClick.bind(this),this.renderItemList();var i=this.config.domEventType==="touch"?"touchend":"click";this._delegates=ft.delegate.call(this,this.root,"li",i,this.onItemClick)}return U(t,[{key:"renderItemList",value:function(r){var i=this,e=this.config,a=this.root;r?e.data=r:r=e.data,e.style&&Object.keys(e.style).map(function(s){a.style[s]=e[s]}),r.length>0&&(this.attrKeys=Object.keys(r[0])),this.root.innerHTML="",r.map(function(s,o){var u=s.selected?"option-item selected":"option-item";s["data-index"]=o,i.root.appendChild(h.createDom("li","<span>".concat(s.showText,"</span>"),s,u))})}},{key:"onItemClick",value:function(r){r.delegateTarget||(r.delegateTarget=r.target);var i=r.delegateTarget;if(i&&h.hasClass(i,"selected"))return!1;var e=typeof this.config.onItemClick=="function"?this.config.onItemClick:null,a=this.root.querySelector(".selected");h.addClass(i,"selected"),a&&h.removeClass(a,"selected"),e(r,{from:a?this.getAttrObj(a,this.attrKeys):null,to:this.getAttrObj(i,this.attrKeys)})}},{key:"getAttrObj",value:function(r,i){if(!r||!i)return{};var e={};i.map(function(s){e[s]=r.getAttribute(s)});var a=r.getAttribute("data-index");return a&&(e.index=Number(a)),e}},{key:"show",value:function(){h.removeClass(this.root,"hide"),h.addClass(this.root,"active")}},{key:"hide",value:function(){h.removeClass(this.root,"active"),h.addClass(this.root,"hide")}},{key:"setStyle",value:function(r){var i=this;Object.keys(r).forEach(function(e){i.root.style[e]=r[e]})}},{key:"destroy",value:function(){this._delegates&&(this._delegates.map(function(r){r.destroy&&r.destroy()}),this._delegates=null),this.root.innerHTML=null,this.parent.removeChild(this.root),this.root=null}}]),t}(),k={SIDE:"side",MIDDLE:"middle",DEFAULT:"default"},$={CLICK:"click",HOVER:"hover"};function Vr(t,n){return t===k.SIDE?n===ae.CONTROLS_LEFT?"xg-side-list xg-left-side":"xg-side-list xg-right-side":""}var H=Ee.device==="mobile",je=function(t){ne(r,t);var n=ie(r);function r(i){var e;return F(this,r),e=n.call(this,i),S(w(e),"onEnter",function(a){a.stopPropagation(),e.emit("icon_mouseenter",{pluginName:e.pluginName}),e.switchActiveState(a)}),S(w(e),"switchActiveState",function(a){a.stopPropagation();var s=e.config.toggleMode;s===$.CLICK?e.toggle(!e.isActive):e.toggle(!0)}),S(w(e),"onLeave",function(a){a.stopPropagation(),e.emit("icon_mouseleave",{pluginName:e.pluginName}),e.config.listType!==k.SIDE&&e.isActive&&e.toggle(!1)}),S(w(e),"onListEnter",function(a){e.enterType=2}),S(w(e),"onListLeave",function(a){e.enterType=0,e.isActive&&e.toggle(!1)}),e.isIcons=!1,e.isActive=!1,e.curValue=null,e.curIndex=0,e}return U(r,[{key:"updateLang",value:function(e){this.renderItemList(this.config.list,this.curIndex)}},{key:"afterCreate",value:function(){var e=this,a=this.config;this.initIcons(),H=H||this.domEventType==="touch",H&&Ee.device==="mobile"&&a.listType===k.DEFAULT&&(a.listType=k.SIDE),a.hidePortrait&&h.addClass(this.root,"portrait"),this.on([lt,ut],function(){e._resizeList()}),this.once(st,function(){a.list&&a.list.length>0&&(e.renderItemList(a.list),e.show())}),H&&this.on(Oe,function(){e.isActive&&(e.optionsList&&e.optionsList.hide(),e.isActive=!1)}),H?(a.toggleMode=$.CLICK,this.activeEvent="touchend"):this.activeEvent=a.toggleMode===$.CLICK?"click":"mouseenter",a.toggleMode===$.CLICK?this.bind(this.activeEvent,this.switchActiveState):(this.bind(this.activeEvent,this.onEnter),this.bind("mouseleave",this.onLeave)),this.isIcons&&this.bind("click",this.onIconClick)}},{key:"initIcons",value:function(){var e=this,a=this.icons,s=Object.keys(a),o=!1;s.length>0&&(s.forEach(function(u){e.appendChild(".xgplayer-icon",a[u]),!o&&(o=a[u])}),this.isIcons=o),!o&&(this.appendChild(".xgplayer-icon",h.createDom("span","",{},"icon-text")),h.addClass(this.find(".xgplayer-icon"),"btn-text"))}},{key:"show",value:function(e){!this.config.list||this.config.list.length<2||h.addClass(this.root,"show")}},{key:"hide",value:function(){h.removeClass(this.root,"show")}},{key:"getTextByLang",value:function(e,a,s){if(e===void 0)return"";var o=this.config.list;!s&&(s=this.player.lang),a=!a||h.isUndefined(e[a])?"text":a,typeof e=="number"&&(e=o[e]);try{return x(e[a])==="object"?e[a][s]||e[a].en:e[a]}catch(u){return console.warn(u),""}}},{key:"toggle",value:function(e){if(!(e===this.isActive||this.config.disable)){var a=this.player.controls,s=this.config.listType;e?(s===k.SIDE?a.blur():a.focus(),this.optionsList&&this.optionsList.show()):(s===k.SIDE?a.focus():a.focusAwhile(),this.optionsList&&this.optionsList.hide()),this.isActive=e}}},{key:"onItemClick",value:function(e,a){e.stopPropagation();var s=this.config,o=s.listType,u=s.list;this.curIndex=a.to.index,this.curItem=u[this.curIndex],this.changeCurrentText();var l=this.config.isItemClickHide;(l||H||o===k.SIDE)&&this.toggle(!1)}},{key:"onIconClick",value:function(e){}},{key:"changeCurrentText",value:function(){if(!this.isIcons){var e=this.config.list,a=this.curIndex<e.length?this.curIndex:0,s=e[a];s&&(this.find(".icon-text").innerHTML=this.getTextByLang(s,"iconText"))}}},{key:"renderItemList",value:function(e,a){var s=this,o=this.config,u=this.optionsList,l=this.player;if(typeof a=="number"&&(this.curIndex=a,this.curItem=o.list[a]),u){u.renderItemList(e),this.changeCurrentText();return}var c={config:{data:e||[],className:Vr(o.listType,o.position),onItemClick:function(m,p){s.onItemClick(m,p)},domEventType:H?"touch":"mouse"},root:o.listType===k.SIDE?l.innerContainer||l.root:this.root};if(this.config.isShowIcon){var f=this.player.root.getBoundingClientRect(),v=f.height,d=o.listType===k.MIDDLE?v-50:v;d&&o.heightLimit&&(c.config.maxHeight="".concat(d,"px")),this.optionsList=new Gr(c),this.changeCurrentText(),this.show()}this._resizeList()}},{key:"_resizeList",value:function(){if(this.config.heightLimit){var e=this.player.root.getBoundingClientRect(),a=e.height,s=this.config.listType===k.MIDDLE?a-50:a;this.optionsList&&this.optionsList.setStyle({maxHeight:"".concat(s,"px")})}}},{key:"destroy",value:function(){var e=this.config;e.toggleMode===$.CLICK?this.unbind(this.activeEvent,this.switchActiveState):(this.unbind(this.activeEvent,this.onEnter),this.unbind("mouseleave",this.onLeave)),this.isIcons&&this.unbind("click",this.onIconClick),this.optionsList&&(this.optionsList.destroy(),this.optionsList=null)}},{key:"render",value:function(){if(this.config.isShowIcon)return'<xg-icon class="xg-options-icon '.concat(this.config.className||"",`">
    <div class="xgplayer-icon">
    </div>
   </xg-icon>`)}}],[{key:"pluginName",get:function(){return"optionsIcon"}},{key:"defaultConfig",get:function(){return{position:ae.CONTROLS_RIGHT,index:100,list:[],listType:"default",listStyle:{},hidePortrait:!0,isShowIcon:!1,isItemClickHide:!0,toggleMode:$.HOVER,heightLimit:!0}}}]),r}(ft);function He(t,n){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);n&&(i=i.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,i)}return r}function z(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?He(Object(r),!0).forEach(function(i){M(t,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):He(Object(r)).forEach(function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(r,i))})}return t}function K(t){"@babel/helpers - typeof";return K=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},K(t)}function q(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}function Be(t,n){for(var r=0;r<n.length;r++){var i=n[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,gt(i.key),i)}}function Z(t,n,r){return n&&Be(t.prototype,n),r&&Be(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function M(t,n,r){return n=gt(n),n in t?Object.defineProperty(t,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[n]=r,t}function Wr(t,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),n&&be(t,n)}function P(t){return P=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(r){return r.__proto__||Object.getPrototypeOf(r)},P(t)}function be(t,n){return be=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(i,e){return i.__proto__=e,i},be(t,n)}function Yr(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function R(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ht(t,n){if(n&&(typeof n=="object"||typeof n=="function"))return n;if(n!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return R(t)}function Xr(t){var n=Yr();return function(){var i=P(t),e;if(n){var a=P(this).constructor;e=Reflect.construct(i,arguments,a)}else e=i.apply(this,arguments);return ht(this,e)}}function Kr(t,n){for(;!Object.prototype.hasOwnProperty.call(t,n)&&(t=P(t),t!==null););return t}function j(){return typeof Reflect<"u"&&Reflect.get?j=Reflect.get.bind():j=function(n,r,i){var e=Kr(n,r);if(e){var a=Object.getOwnPropertyDescriptor(e,r);return a.get?a.get.call(arguments.length<3?n:i):a.value}},j.apply(this,arguments)}function qr(t,n){if(typeof t!="object"||t===null)return t;var r=t[Symbol.toPrimitive];if(r!==void 0){var i=r.call(t,n);if(typeof i!="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(t)}function gt(t){var n=qr(t,"string");return typeof n=="symbol"?n:String(n)}var ge=/^WEBVTT/,Zr=/^STYLE+$/,Jr=/^\:\:cue/,Qr=/^}+$/,Fe=/^\[Script Info\].*/,Ue=[/[0-9]{1,3}:[0-9]{2}:[0-9]{2}\.[0-9]{1,3}-->[0-9]{1,3}:[0-9]{2}:[0-9]{2}\.[0-9]{1,3}/,/[0-9]{1,3}:[0-9]{2}\.[0-9]{1,3}-->[0-9]{1,3}:[0-9]{2}\.[0-9]{1,3}/,/[0-9]{1,2}\.[0-9]{1,3}-->[0-9]{1,2}\.[0-9]{1,3}/],ve=50,$e=/^Format:\s/,ze=/^Style:\s/,Ge=/^Dialogue:\s/;function de(t){var n=t.length;return n===3?((Number(t[0])*60+Number(t[1]))*60*1e3+Number(t[2])*1e3)/1e3:n===2?(Number(t[0])*60*1e3+Number(t[1])*1e3)/1e3:Number(t[0])}function en(t){return/^(\-|\+)?\d+(\.\d+)?$/.test(t)}function Ve(t,n){return t>=0&&t<n.length?n[t]:""}var We=function(){function t(){q(this,t)}return Z(t,null,[{key:"parseJson",value:function(r){for(var i=[],e=0,a=0;a<r.length;a++){if(e>=ve&&(e=0),e===0){var s={start:r[a].start,list:[r[a]],end:r[a].end};i.push(s)}else i[i.length-1].list.push(r[a]),i[i.length-1].end=r[a].end;e++}return i}},{key:"parse",value:function(r,i){var e=t.checkFormat(r);e||i({format:e});try{var a=[];e==="ass"?a=t.parseASS(r):e==="vtt"&&(a=t.parseVTT(r)),i({format:e,list:a.list,styles:a.styles})}catch(s){console.error(s),i({format:e},s)}}},{key:"parseASSItem",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],e=r.split(","),a={},s="";try{var o=e.length-i.length;return o>0?s=e.splice(i.length-1,o+1).join(",")+"":s=e[e.length-1]+"",s=s.replace(/\\n+/g,""),s=s,e[i.length-1]=s,i.map(function(u,l){u==="end"||u==="start"?a[u]=de(e[l].split(":")):u==="text"?a[u]=[e[l]]:u==="layer"?(a[u]=[e[l]],a.textTag=[e[l]]):u==="style"?a[u]=[e[l]]:a[u]=Number(e[l])?Number(e[l]):e[l]}),a}catch(u){return console.error(u),{}}}},{key:"parseASS",value:function(r){for(var i=r.split(`
`),e=[],a=0,s=0,o=[],u=[],l=null;a<i.length;){if($e.test(i[a]))u=i[a].replace($e,"").replace(/\s+/g,"").split(","),u=u.map(function(p){return p.toLocaleLowerCase()});else if(ze.test(i[a]))o.push(i[a].replace(ze,"").replace(/\s+/g,""));else if(Ge.test(i[a])){var c=t.parseASSItem(i[a].replace(Ge,""),u);if(!l||!(c.start===l.start&&c.end===l.end)){l=c;var f=null;s%ve===0?(f={start:l.start,end:l.end,list:[]},f.list.push(l),e.push(f)):(f=e[e.length-1],f.end=l.end,f.list.push(l)),s++}else try{var v=l,d=v.text,g=v.textTag,m=v.style;d.push(c.text[0]),g.push(c.textTag[0]),m.push(c.style[0])}catch(p){console.error(p)}}a++}return{list:e,style:{}}}},{key:"parseVTTStyle",value:function(r,i){var e=r.split(":");if(e.length>1){var a=e[0].trim().split("-"),s="";a.length>1?a.map(function(o,u){s+=u===0?o:o.charAt(0).toUpperCase()+o.slice(1)}):s=a[0],i[s]=e[1].trim().replace(/;$/,"")}return i}},{key:"parseVTT",value:function(r){r=r.replace(ge,"");for(var i=r.split(`
`),e=[],a=0,s=0,o=null,u=!1,l=!1,c=null,f=null,v=[];a<i.length;){var d=Ve(a,i).trim();if(!d||u&&en(d))u=!d;else if(Jr.test(d)&&Zr.test(Ve(a-1,i).trim())){l=!0;var g=/\((.+?)\)/g.exec(d);g?f=g[1]:f="",c=""}else if(l)Qr.test(d)?(v.push({key:f,style:c}),c=null,f=null,l=!1):c+=d;else if(d){u=!1;var m=this.checkIsTime(i[a]);if(m){var p=this.parseVttTime(m);if(!o||!(p.start===o.start&&p.end===o.end)){o=p,o.text=[],o.textTag=[];var y=null;s%ve===0?(y={start:o.start,end:o.end,list:[]},y.list.push(o),e.push(y)):(y=e[e.length-1],y.end=o.end,y.list.push(o)),s++}}else if(o){var b=o,_=b.text,O=b.textTag,E=this.parseVttText(i[a]);_.push(E.text),O.push(E.tag)}u=!1}a++}return{list:e,styles:v}}},{key:"checkIsTime",value:function(r){r=r.replace(/\s+/g,"");for(var i=0,e=null;i<Ue.length&&(e=Ue[i].exec(r),!e);)i++;return e?e[0]:null}},{key:"parseVttText",value:function(r){var i=/^(<?.+?>)/g.exec(r),e="",a="default";if(i){a=i[0].replace(/\<|\>|\&/g,"");var s=RegExp("^<".concat(a,">(([\\s\\S])*?)</").concat(a,">$")),o=s.exec(r);o?e=o[1]:(e=r,a="")}else e=r;for(var u=/<(\w+).(\w+)>/g,l=u.exec(e);l&&l.length>2;)e=e.replace(l[0],"<".concat(l[1],' class="').concat(l[2],'">')),l=u.exec(e);return{tag:a,text:e.replace(/\\n+/g,"<br/>")}}},{key:"parseVttTime",value:function(r){var i=r.split("-->"),e,a=0;if(i.length===2){var s=i[0].split(":"),o=i[1].split(":");e=de(s),a=de(o)}return{start:e,end:a,time:r}}},{key:"isVTT",value:function(r){return ge.test(r)}},{key:"isASS",value:function(r){return Fe.test(r)}},{key:"checkFormat",value:function(r){return r?ge.test(r)?"vtt":Fe.test(r)?"ass":null:null}}]),t}(),Ye=[{code:0,msg:"SUCCESS"},{code:1,msg:"LOAD_ERROR"},{code:2,msg:"PARSER_ERROR"},{code:3,msg:"FORMAT_NOT_SUPPORTED"},{code:4,msg:"ID_OR_LANGUAGE_NOT_EXIST"},{code:5,msg:"PARAMETERS_ERROR"},{code:6,msg:"ABORT"},{code:7,msg:"UNKNOWN"},{code:8,msg:"DATA_ERROR:subtitle.url is null"},{code:9,msg:"DATA_ERROR:subtitle.url length is 0"}];function I(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r={code:Ye[t].code,msg:Ye[t].msg};return Object.keys(n).map(function(i){r[i]=n[i]}),r}var tn=Z(function t(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=n.url,i=n.method,e=i===void 0?"GET":i,a=n.type,s=a===void 0?"arraybuffer":a,o=n.timeout,u=o===void 0?1e4:o,l=n.data,c=l===void 0?{}:l,f=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return q(this,t),new Promise(function(v,d){var g=new window.XMLHttpRequest,m=e.toUpperCase(),p=[];if(s&&(g.responseType=s),u&&(g.timeout=u),Object.keys(c).forEach(function(y){p.push("k=".concat(c[y]))}),g.onload=function(){g.status===200||g.status===206?v({context:f,res:g}):d(new Error({context:f,res:g,type:"error"}))},g.onerror=function(y){d(new Error({context:f,res:g,type:"error"}))},g.ontimeout=function(y){d(new Error({context:f,res:g,type:"error"}))},g.onabort=function(){d(new Error({context:f,res:g,type:"error"}))},m==="GET")g.open(m,"".concat(r)),g.send();else if(m==="post")g.open(m,r),g.setRequestHeader("Content-type","application/x-www-form-urlencoded"),g.send(p.join("&"));else throw new Error("xhr ".concat(m," is not supported"))})}),Se=function(){function t(){q(this,t);var n,r,i=new Promise(function(a,s){n=a,r=s}),e=i;return e.resolve=function(a){n(a),e.state="fulfilled"},e.reject=function(a){r(a),e.state="rejected",e.isBreak=a==="DESTROYED"},e.state="pending",e}return Z(t,[{key:"resolve",value:function(r){}},{key:"reject",value:function(r){}}]),t}();function vt(t,n){if(!t)return!1;if(t.classList)return Array.prototype.some.call(t.classList,function(i){return i===n});var r=t.className&&K(t.className)==="object"?t.getAttribute("class"):t.className;return r&&!!r.match(new RegExp("(\\s|^)"+n+"(\\s|$)"))}function re(t,n){t&&(t.classList?n.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach(function(r){r&&t.classList.add(r)}):vt(t,n)||(t.className&&K(t.className)==="object"?t.setAttribute("class",t.getAttribute("class")+" "+n):t.className+=" "+n))}function rn(t,n){t&&(t.classList?n.split(/\s+/g).forEach(function(r){t.classList.remove(r)}):vt(t,n)&&n.split(/\s+/g).forEach(function(r){var i=new RegExp("(\\s|^)"+r+"(\\s|$)");t.className&&K(t.className)==="object"?t.setAttribute("class",t.getAttribute("class").replace(i," ")):t.className=t.className.replace(i," ")}))}function Xe(t,n,r){var i=n.length;if(i<1)return-1;if(r=r<0?0:r>=i?i-1:r,n[r].start<=t&&t<n[r].end)return r;for(var e=n[r].end<=t?r+1:0;e<i;e++){if(n[e].start<=t&&t<n[e].end)return e;if(t>n[e].end&&e+1<i&&t<n[e+1].start)return-1;if(t>n[e].end&&e+1>=i)return-1}return-1}function Ke(t,n,r){var i=n.length;if(i<1)return[];r=r<0?0:r>=i?i-1:r;var e=[];if(r<i)for(var a=n[r].end<=t?r:0;a<i&&(n[a].start<=t&&t<n[a].end&&e.push(a),!(t<n[a].start));a++);return e}function nn(t,n,r){if(t.length===0||n<0||n>t.length-1)return[];var i=t[n].list;if(r.length===0)return[];var e=i.splice(r[0],r.length);return n>0&&t.splice(0,n),i.length===0&&t.splice(0,1),e}function Te(t){return Object.prototype.toString.call(t).match(/([^\s.*]+)(?=]$)/g)[0]}function qe(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"div",n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:"",e=document.createElement(t);return e.className=i,e.innerHTML=n,Object.keys(r).forEach(function(a){var s=a,o=r[a];t==="video"||t==="audio"||t==="live-video"?o&&e.setAttribute(s,o):e.setAttribute(s,o)}),e}function an(){var t=navigator.userAgent,n=/(?:Windows Phone)/.test(t),r=/(?:SymbianOS)/.test(t)||n,i=/(?:Android)/.test(t),e=/(?:Firefox)/.test(t),a=/(?:iPad|PlayBook)/.test(t)||i&&!/(?:Mobile)/.test(t)||e&&/(?:Tablet)/.test(t),s=/(?:iPhone)/.test(t)&&!a;return s||i||r||a}function sn(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",r="";t.map(function(o){r+=" ".concat(n," ").concat(o.key," {").concat(o.style,"}")});var i=document.createElement("style"),e=document.head||document.getElementsByTagName("head")[0];if(i.type="text/css",i.id="ssss",i.styleSheet){var a=function(){try{i.styleSheet.cssText=r}catch{}};i.styleSheet.disabled?setTimeout(a,10):a()}else{var s=document.createTextNode(r);i.appendChild(s)}e.appendChild(i)}function dt(t,n,r){if(r||(r=new Se),n==="json"){var i=We.parseJson(t);r.resolve({list:i,format:"json"})}else n==="string"&&We.parse(t,function(e,a){if(a){var s=I(2,a);r.reject(s,{format:e.format})}else if(e.format)r.resolve({styles:e.styles,list:e.list,format:e.format});else{var o=I(3);r.reject(o)}});return r}function Ze(t,n){return n||(n=new Se),new tn({url:t.url,type:"text"}).then(function(r){dt(r.res.response,"string").then(function(i){n.resolve(z(z({},i),t))}).catch(function(i){n.reject(i)})}).catch(function(r){var i=I(1,z({statusText:r.statusText,status:r.status,type:r.type,message:"http load error",url:t.src},t));n.reject(i)}),n}function B(t,n){return!!(t.id&&n.id&&t.id===n.id||t.language&&n.language&&t.language===n.language)}function on(t){return t===null||t.trim()===""?!1:/^[a-zA-Z]+$/.test(t)}function un(t){var n=/[\x21-\x2f\x3a-\x40\x5b-\x60\x7B-\x7F]/;return!!n.test(t)}function ln(t){var n=/[\u3002|\uff1f|\uff01|\uff0c|\u3001|\uff1b|\uff1a|\u201c|\u201d|\u2018|\u2019|\uff08|\uff09|\u300a|\u300b|\u3008|\u3009|\u3010|\u3011|\u300e|\u300f|\u300c|\u300d|\ufe43|\ufe44|\u3014|\u3015|\u2026|\u2014|\uff5e|\ufe4f|\uffe5]/;return!!n.test(t)}function cn(t){for(var n=t.split(""),r=[],i=!1,e=0;e<n.length;e++){var a=n[e];if(on(a))if(!i)r.push(a),i=!0;else{var s=r.length-1;r[s]="".concat(r[s]).concat(a)}else if(a.match(/^[ ]*$/)||un(a)||ln(a)){i=!1;var o=r.length-1;r[o]="".concat(r[o]).concat(a)}else i=!1,r.push(a)}return r}var fn=function(){function t(){var n=this;q(this,t),this.__handlers=[],window.ResizeObserver&&(this.observer=new window.ResizeObserver(function(r){n.__trigger(r)}))}return Z(t,[{key:"addObserver",value:function(r,i){if(this.observer){this.observer&&this.observer.observe(r);for(var e=this.__handlers,a=-1,s=0;s<e.length;s++)e[s]&&r===e[s].target&&(a=s);a>-1?this.__handlers[a].handler.push(i):this.__handlers.push({target:r,handler:[i]})}}},{key:"unObserver",value:function(r){var i=-1;this.__handlers.map(function(e,a){r===e.target&&(i=a)}),this.observer&&this.observer.unobserve(r),i>-1&&this.__handlers.splice(i,1)}},{key:"destroyObserver",value:function(){this.observer&&this.observer.disconnect(),this.observer=null,this.__handlers=null}},{key:"__runHandler",value:function(r,i){for(var e=this.__handlers,a=0;a<e.length;a++)if(e[a]&&r===e[a].target){e[a].handler&&e[a].handler.forEach(function(s){try{s(r,i)}catch(o){console.error(o)}});break}}},{key:"__trigger",value:function(r){var i=this;r.map(function(e){var a=e.contentRect;i.__runHandler(e.target,a)})}}]),t}(),X=null;function hn(t,n){X||(X=new fn),X.addObserver(t,n)}function gn(t,n){X&&X.unObserver(t,n)}var pe={RESIZE:"resize",CHANGE:"change",OFF:"off"};function Je(t){var n=[];return t&&Te(t)==="String"?n.push({url:t,index:0,start:-1,end:-1}):Te(t)==="Array"&&t.forEach(function(r,i){n.push({url:r.url||r.src,index:i,start:r.start||-1,end:r.end||-1})}),n}var Qe=!1,vn=function(t){Wr(r,t);var n=Xr(r);function r(i){var e;return q(this,r),e=n.call(this),M(R(e),"_onPause",function(){e.stopRender()}),M(R(e),"_onPlay",function(){e._curRenderTask.length>0&&e.startRender(-1)}),M(R(e),"_onTimeupdate",function(){if(e._isOpen){var a=e.player.video,s=a.videoWidth,o=a.videoHeight;!e._videoMeta.scale&&s&&o&&e._onResize(e.player.root);var u=e._getPlayerCurrentTime();Math.round(Math.abs(u*1e3-e._ctime))<200||(e._ctime=u*1e3,e.currentText&&e.currentText.list&&(e.config.updateMode==="live"?e._liveUpdate(u):e._update(u)))}}),M(R(e),"_onResize",function(a){var s=R(e),o=s._videoMeta,u=s.config;if(u.domRender){if((!a||!(a instanceof window.Element))&&(a=e.player.root),e._iId&&(clearTimeout(e._iId),e._iId=null),!o.scale){if(!e.player.video)return;var l=e.player.video,c=l.videoWidth,f=l.videoHeight;if(c&&f)o.videoWidth=c,o.videoHeight=f,o.scale=parseInt(f/c*100,10);else return}e.__startResize(a)}}),M(R(e),"_onCoreEvents",function(a){try{switch(a.eventName){case"core.subtitlesegments":e._onSubtitleSegment(a.list||[]);break;case"core.subtitleplaylist":e._onSubtitlePlaylist(a.list||[]);break;case"core.seipayloadtime":e._onCoreSeiintime(a);break;default:}}catch(s){console.error(s)}}),M(R(e),"startRender",function(a){if(a>0&&e._renderIntervalId&&(window.cancelAnimationFrame(e._renderIntervalId),e._renderIntervalId=-1),!!e.textTrack){var s=R(e),o=s._curRenderTask;e._lastTimeStamp=new Date().getTime();var u=[];o.forEach(function(l,c){var f=l.lastTime,v=l.wordList,d=l.interval,g=l.dom,m=l.ids;if(a<0||e._lastTimeStamp<0||e._lastTimeStamp-f>=d){var p=v.shift();p&&g.appendData(p),l.lastTime=e._lastTimeStamp}v.length<1&&u.push({index:c,ids:m})}),e._log(">>>>_renderByWords emptyArr",u.length,o.length),u.forEach(function(l){o.splice(l.index,1),e._log(">>>_renderByWords remove emptyArr",l.index,o.length)}),o.length>0&&(e._renderIntervalId=window.requestAnimationFrame(e.startRender))}}),M(R(e),"destroy",function(){e.detachPlayer(),e.removeAllListeners(),e.player=null,e.textTrack=null,e._curRenderTask=[],e.stopRender()}),Qe=an(),e.currentText=null,e.currentExtText=null,e.textTrack=[],e._cid=-1,e._gid=-1,e._cids=[],e._iId=null,e._iC=0,e.player=null,e.root=null,e.config={line:"double",bottom:0,mode:"stroke",defaultOpen:!1,baseSizeX:49,baseSizeY:28,minSize:16,minMobileSize:13,fitVideo:!0,offsetBottom:2,fontColor:"#fff",domRender:!0,updateMode:"vod",renderMode:"",debugger:!1},e._ctime=0,e._loadingTrack={},Object.keys(e.config).map(function(a){i[a]!==void 0&&i[a]!==null&&(e.config[a]=i[a])}),e._isOpen=e.config.defaultOpen||!1,e._videoMeta={scale:0,videoHeight:0,videoWidth:0,lwidth:0,lheight:0,vWidth:0,vHeight:0,vBottom:0,vLeft:0,marginBottom:0},!i.subTitles||Te(i.subTitles)!=="Array"?ht(e):(i.player&&e.attachPlayer(i.player),e.seiTime=0,e.lastSeiTime=0,e._curTexts=[],e._curRenderTask=[],e._renderIntervalId=-1,e._lastTimeStamp=-1,e.setSubTitles(i.subTitles,e.config.defaultOpen),e)}return Z(r,[{key:"version",get:function(){return"3.0.22"}},{key:"setSubTitles",value:function(){var e=this,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!0,u=this._isOpen||s;o&&this.innerRoot&&this.switchOff(),this.currentText=null,this.textTrack=[],a.forEach(function(l){var c={};Object.keys(l).map(function(f){c[f]=l[f]}),c.url=Je(c.url),c.isDefault&&(e.currentText=c),e.textTrack.push(c)}),this._log("setSubTitles",u),u&&this.switch().catch(function(l){e._log("[switch]",l)}),this.currentText&&this._loadTrack(this.currentText).then(function(l){e.addStyles(l)}),this.emit("reset",{list:this.textTrack,isOpen:u})}},{key:"updateSubTitle",value:function(e){for(var a=this,s=-1,o=0;o<this.textTrack.length;o++)if(B(e,this.textTrack[o])){s=o;break}if(this._log("updateSubTitle",s,e),s>-1){var u=B(this.currentText,this.textTrack[s]);if(this._log("updateSubTitle","_isCurrent",u,"this.isOpen",this.isOpen,this.currentText),!u)return;var l=Je(e.url);this.isOpen?(l.forEach(function(c){a.textTrack[s].url.push(c)}),this._log("updateSubTitle _loadTrackUrls",this.textTrack[s]),this._loadTrackUrls(this.currentText,2)):this.textTrack[s].url=l}}},{key:"addStyles",value:function(e){var a=e.styles,s=e.format;a&&s==="vtt"&&(a.map(function(o){o.key||(o.key="xg-text-track-span")}),sn(a,"xg-text-track"))}},{key:"attachPlayer",value:function(e){var a=this;if(this._log("attachPlayer"),!!e){this.player&&this.detachPlayer();var s=this.config,o=s.fontColor,u=s.mode,l=s.fitVideo,c=s.domRender;this.player=e,c&&(this.root=document.createElement("xg-text-track"),this.root.className="xg-text-track",!this._isOpen&&re(this.root,"text-track-hide"),!l&&re(this.root,"text-track-no-fitvideo"),u&&re(this.root,"text-track-".concat(u)),this.innerRoot=document.createElement("xg-text-track-inner"),this.root.appendChild(this.innerRoot),o&&(this.root.style.color=o),this.currentText&&["language","id","label"].map(function(f){a.root.setAttribute("data-".concat(f),a.currentText[f]||"")}),this.player.root.appendChild(this.root),hn(e.root,this._onResize)),this.player.on("destroy",this.destroy),this.player.on("timeupdate",this._onTimeupdate),this.player.on("pause",this._onPause),this.player.on("play",this._onPlay),this.player.on("core_event",this._onCoreEvents),this._isOpen&&this.switch().catch(function(f){a._log("[switch]",f)})}}},{key:"detachPlayer",value:function(){var e=this.player,a=this.config;e&&(e.off("destroy",this.destroy),e.off("timeupdate",this._onTimeupdate),e.off("pause",this._onPause),e.off("play",this._onPlay),e.off("core_event",this._onCoreEvents),a.domRender&&(e.root&&(gn(e.root,this._onResize),e.root.removeChild(this.root)),this.innerRoot=null,this.root=null),this.player=null)}},{key:"switch",value:function(){var e=this,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:"",language:""};return this._log("switch",a),this._loadingTrack=a,new Promise(function(s,o){if(!a.id&&!a.language)if(e.currentText){e._loadingTrack={},e._updateCurrent(e.currentText),e.switchOn();var u=I(0,{message:"switch default subtitle success"});s(u);return}else{var l=I(5,{message:"no default subtitle"});o(l);return}if(e.currentText&&B(a,e.currentText))e._loadingTrack={},e._updateCurrent(e.currentText),e.switchOn(),s(I(0));else{var c=null;e.__removeByTime(e._curTexts,0);for(var f=0;f<e.textTrack.length;f++)if(B(a,e.textTrack[f])){c=e.textTrack[f];break}if(e._log("nextSubtitle",c),c)e._emitPlayerSwitch(e.currentText,c),c.list?(e._loadingTrack={},e._updateCurrent(c),e.switchOn(),s(I(0))):(e._log("this._loadTrack",c),e._updateCurrent(c),e._loadTrack(c).then(function(d){if(e.addStyles(d),e._loadingTrack.id===c.id||e._loadingTrack.language===d.language)e._loadingTrack={},e._updateCurrent(d),e.switchOn(),s(I(0));else{var g=I(6,{message:"check _loadingTrack fail id: ".concat(e._loadingTrack.id,"  nextSubtitle:").concat(d.id)});o(g)}}).catch(function(d){o(d)}));else{var v=I(4,new Error("The is no subtitle with id:[{".concat(a.id,"}] or language:[").concat(a.language,"]")));o(v)}}})}},{key:"switchExt",value:function(){var e=this,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:"",language:""};return new Promise(function(s,o){if(!a.id&&!a.language)e.currentExtText=null,s(I(0));else{for(var u=null,l=0;l<e.textTrack.length;l++)if(B(a,e.textTrack[l])){u=e.textTrack[l];break}u&&!B(u,e.currentText)&&e._loadTrack(u).then(function(c){e.currentExtText=c,s(I(0))})}})}},{key:"switchOn",value:function(){this._log("switchOn"),this._isOpen=!0,this.show(),this.emit(pe.CHANGE,this.currentText)}},{key:"switchOff",value:function(){this._isOpen=!1,this.hide(),this.emit(pe.OFF)}},{key:"isOpen",get:function(){return this._isOpen}},{key:"_log",value:function(){if(this.config.debugger){for(var e,a=arguments.length,s=new Array(a),o=0;o<a;o++)s[o]=arguments[o];(e=console).log.apply(e,["[xgSubtitle]"].concat(s))}}},{key:"_loadTrack",value:function(e){var a=this;this._log("_loadTrack",e.language,e);var s=new Se,o="",u="";if(e.json?(o="json",u=e.json):e.stringContent&&!e.url&&(o="string",u=e.stringContent),u)return dt(u,o).then(function(f){e.format=f.format,e.styles=f.styles,e.list=f.list,s.resolve(e)}).catch(function(f){s.reject(f)}),s;var l=e.url;if(l.length===0)return s.resolve(e),s;var c=l.splice(0,1);return Ze(c[0]).then(function(f){e.format=f.format,e.styles=f.styles,e.list||(e.list=[]),a._pushList(e.list,f.list),l.length>1&&a._loadTrackUrls(e,2),s.resolve(e)}).catch(function(f){s.reject(f)}),s}},{key:"_emitPlayerSwitch",value:function(e,a){e&&this.config.updateMode==="live"&&(e.list=[],e.url=[]);var s=z({lang:a.language},a);this._log("emit subtile_switch ",a,s),this.player&&this.player.emit("switch_subtitle",s)}},{key:"_loadTrackUrls",value:function(e,a,s){var o=this,u=e.url.length,l=u>a?e.url.splice(0,a):e.url.splice(0,u),c=l.length;this._log("_loadTrackUrls",e.language,u,l.length,c),l.forEach(function(f,v){var d=z(z({},f),{},{index:v});Ze(d).then(function(g){e.format=g.format,e.styles=g.format,e.list||(e.list=[]),o._pushList(e.list,g.list),c--}).catch(function(g){c--}).finally(function(g){c===0&&(s&&s.resolve(e),o._loadTrackUrls(e,2))})})}},{key:"_freshUrl",value:function(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{url:""},s=-1;e.url.forEach(function(o,u){o.url===a.url&&(s=u)}),s>-1&&e.url.splice(s,1)}},{key:"_pushList",value:function(e,a){var s=a[0].start,o=a[a.length-1].end;if(e.length===0||s>=e[e.length-1].end)a.forEach(function(c){e.push(c)});else{for(var u=-1,l=0;l<e.length;l++)if(e[l].start>o){u=l;break}u>-1&&a.forEach(function(c,f){e.splice(u+f,0,c)})}return e}},{key:"_updateCurrent",value:function(e){var a=this;this.currentText=e,this.config.domRender&&this.root&&(["language","id","label"].map(function(o){a.root.setAttribute("data-".concat(o),a.currentText[o]||"")}),this.__remove(this._cids)),this._cids=[],this._gid=-1,this._cid=-1,this._curTexts=[];var s=this._getPlayerCurrentTime();s&&(this.config.updateMode==="live"?this._liveUpdate(s):this._update(s))}},{key:"__loadAll",value:function(){var e=this;this.textTrack.forEach(function(a){e._loadTrack(a)})}},{key:"getDelCid",value:function(e,a){for(var s=[],o=0;o<e.length;o++)a.includes(e[o])||s.push(e[o]);return s}},{key:"getNewCid",value:function(e,a){for(var s=[],o=0;o<a.length;o++)e.includes(a[o])||s.push(a[o]);return s}},{key:"_liveUpdate",value:function(e){var a=this;if(!(!this.currentText||!this.currentText.list||!this.currentText.list.length)){var s=[],o=Xe(e,this.currentText.list,this._gid);if(o>-1&&(s=Ke(e,this.currentText.list[o].list,this._cid)),this.__removeByTime(this._curTexts,e),this._log("_liveUpdate",e,o,s,this.currentText.list[0].list[0].start,this.currentText.list[0].list[0].end),s.length>0){var u=nn(this.currentText.list,o,s),l=this._curTexts.length,c=l>0?this._curTexts[l-1].index:0;u.forEach(function(f,v){f.index=v+c,a._curTexts.push(f)}),this.__render(u)}this.emit("update",this._curTexts)}}},{key:"_update",value:function(e){var a=this;if(!(!this.currentText||!this.currentText.list||!this.currentText.list.length)){var s=Xe(e,this.currentText.list,this._gid),o=[];if(s>-1&&(o=Ke(e,this.currentText.list[s].list,this._cid)),o.length<1){this._cids.length>0&&this.config.domRender&&this.__remove(this._cids),this._cids=[];return}if(!(this._cids===o&&s===this._gid)){this._gid=s,this._cid=o[0];var u=this.getDelCid(this._cids,o),l=this.getNewCid(this._cids,o);this._cids=o,this.config.domRender&&this.__remove(u);var c=[];l.map(function(f){var v=a.currentText.list[s].list[f];v.index=f,c.push(v)}),this.currentExtText&&l.map(function(f){var v=a.currentText.list[s].list[f];v.index=f,c.push(v)}),this._log("update",c,e),this.emit("update",c),this.__render(c,e)}}}},{key:"_getPlayerCurrentTime",value:function(){if(!this.player)return 0;var e=this.player.currentTime,a=parseInt(e*1e3+this.seiTime*1e3-this.lastSeiTime*1e3,10)/1e3;return a}},{key:"_onSubtitlePlaylist",value:function(e){this._log("_onSubtitlePlaylist",e);var a=e.map(function(s){return{label:s.name,language:s.lang,id:s.id,isDefault:s.default,url:[],mUrl:s.url}});this.setSubTitles(a)}},{key:"_onSubtitleSegment",value:function(e){if(this._log("_onSubtitleSegment",e.length,e[0].lang,e[0].sn,e[e.length-1].sn,e[0].start,e[e.length-1].end),!(!e||e.length===0)){var a=e[0].lang,s=e.map(function(u){return{id:u.sn,url:u.url,duration:u.duration,start:u.start,end:u.end}}),o={language:a,url:s};B(o,this.currentText)&&this.updateSubTitle(o)}}},{key:"_onCoreSeiintime",value:function(e){try{var a=e.time/1e3;this._log("_onCoreSeiintime sei",a,this.seiTime,this.lastSeiTime),this.seiTime=a,this.lastSeiTime=this.player?this.player.currentTime:0}catch{}}},{key:"resize",value:function(e,a){var s=this,o=this.config,u=o.baseSizeX,l=o.baseSizeY,c=o.minMobileSize,f=o.minSize,v=o.fitVideo,d=o.offsetBottom,g=this._videoMeta.scale;this._videoMeta.lwidth=e,this._videoMeta.lheight=a;var m,p=0;a/e*100>=g?(p=parseInt(g*e,10)/100,m=e):(p=a,m=parseInt(a/g*100,10)),this._videoMeta.vWidth=m,this._videoMeta.vHeight=p;var y=0,b=0;g>120?(y=l,b=parseInt(y*p/1080,10)):(y=u,b=parseInt(y*m/1920,10));var _=Qe?c:f;b=b<_?_:b>y?y:b;var O={fontSize:b},E=parseInt((a-p)/2,10),G=parseInt((e-m)/2,10),V=parseInt(p*d,10)/100;this._videoMeta.vBottom=E,this._videoMeta.vLeft=G,this._videoMeta.marginBottom=V,v&&(O.bottom=E+V,O.left=O.right=G),Object.keys(O).map(function(J){s.root.style[J]="".concat(O[J],"px")}),this.emit(pe.RESIZE,{vLeft:G,vBottom:E,marginBottom:V,vWidth:m,vHeight:p,fontSize:b,scale:g})}},{key:"__startResize",value:function(e){var a=this,s=e.getBoundingClientRect(),o=this._videoMeta,u=s.width,l=s.height;if(this._iId&&(clearTimeout(this._iId),this._iId=null),u>0&&l>0&&(u!==o.lwidth||l!==o.lheight))this._iC=0,this.resize(u,l);else{if(this._iC>=5){this._iC=0;return}this._iC++,this._iId=setTimeout(function(){a.__startResize(e)},50)}}},{key:"__removeByTime",value:function(e,a){for(var s=[],o=0;o<e.length;o++)(!a||e[o].end<a)&&s.push(o);s.length!==0&&(e.splice(s[0],s.length),this.config.domRender&&this.__remove(s))}},{key:"__remove",value:function(e){var a=this;if(!(!e||e.length<1)){this._log(">>>>_renderByWords__remove",e);for(var s=this.innerRoot.children,o=[],u=0;u<s.length;u++){var l=Number(s[u].getAttribute("data-index"));e.includes(l)&&o.push(s[u])}o.map(function(c){a.innerRoot.removeChild(c)})}}},{key:"__render",value:function(){var e=this,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];this._log("__render",a.length,this.config.domRender);var s=this.config,o=s.renderMode,u=s.domRender;a.length>0&&u&&a.forEach(function(l){var c="text-track-".concat(e.config.line);l.text.forEach(function(f,v){v>0&&(c+=" text-track-deputy");var d={"data-start":l.start,"data-end":l.end,"data-index":l.index},g=qe("xg-text-track-span","",d,c);if(e.innerRoot.appendChild(g),o==="step"){var m=qe("xg-text-track-span","",d,"".concat(c," text-track-space"));e.innerRoot.appendChild(m),m.innerHTML=f,setTimeout(function(){e._renderByWords(g,v,l.start,l.end,f)},600)}else g.innerHTML=f})})}},{key:"_renderByWords",value:function(e,a,s,o,u){var l=document.createTextNode("");e.appendChild(l);var c=cn(u),f=this._getPlayerCurrentTime(),v=parseInt((o-f)*1e3,10);if(!(f>=o)){s>=f&&(f=s),v>300&&(v-=50);var d=c.length,g={dom:l,ids:a,wordList:c,interval:v/d,start:f,end:o,duration:v,lastTime:0};this._log(">>>>_renderByWords",v,g);for(var m=this._curRenderTask,p=-1,y=0;y<m.length;y++)if(m[y].ids===a){p=y;break}p>-1&&m.slice(p,1),m.push(g),this.startRender(-1)}}},{key:"stopRender",value:function(){this._renderIntervalId&&window.cancelAnimationFrame(this._renderIntervalId)}},{key:"show",value:function(){this.config.domRender&&rn(this.root,"text-track-hide")}},{key:"hide",value:function(){this.config.domRender&&(re(this.root,"text-track-hide"),this.innerRoot.innerHTML="")}},{key:"emit",value:function(e,a){for(var s,o=arguments.length,u=new Array(o>2?o-2:0),l=2;l<o;l++)u[l-2]=arguments[l];(s=j(P(r.prototype),"emit",this)).call.apply(s,[this,e,a].concat(u))}},{key:"on",value:function(e,a){for(var s,o=arguments.length,u=new Array(o>2?o-2:0),l=2;l<o;l++)u[l-2]=arguments[l];(s=j(P(r.prototype),"on",this)).call.apply(s,[this,e,a].concat(u))}},{key:"once",value:function(e,a){for(var s,o=arguments.length,u=new Array(o>2?o-2:0),l=2;l<o;l++)u[l-2]=arguments[l];(s=j(P(r.prototype),"once",this)).call.apply(s,[this,e,a].concat(u))}},{key:"off",value:function(e,a){for(var s,o=arguments.length,u=new Array(o>2?o-2:0),l=2;l<o;l++)u[l-2]=arguments[l];(s=j(P(r.prototype),"off",this)).call.apply(s,[this,e,a].concat(u))}},{key:"offAll",value:function(){j(P(r.prototype),"removeAllListeners",this).call(this)}},{key:"marginBottom",get:function(){var e=this._videoMeta,a=e.bottom,s=e.marginBottom;return this.config.fitVideo?a+s:s}}]),r}(it),dn=function(t){ne(r,t);var n=ie(r);function r(i){var e;return F(this,r),e=n.call(this),S(w(e),"_onChange",function(a){var s=e._media.textTracks;if(!(!s||s.length===0)){for(var o=[],u=[],l=-1,c=0;c<s.length;c++){var f=s[c];f.kind==="subtitles"&&(o.push({id:f.id||f.language,language:f.language,text:f.label,isDefault:f.mode==="showing"}),l===-1&&f.mode==="showing"&&(l=c),u.push(f.language))}u.join("|")!==e._languages?(e._languages=u.join("|"),e.emit("reset",{list:o,isOpen:l>-1})):l===-1?e.emit("off"):e.curIndex!==l&&e.emit("change",o[l]),e.curIndex=l}}),e._media=i,e._list=[],e._languages="",e.curIndex=-1,e._init(),e}return U(r,[{key:"_init",value:function(){var e=this._media.textTracks;e.addEventListener("change",this._onChange)}},{key:"switch",value:function(e){for(var a=this._media.textTracks,s=0;s<a.length;s++){var o=a[s];o.language===e.language?o.mode="showing":o.mode==="showing"&&(o.mode="disabled")}}},{key:"switchOff",value:function(){for(var e=this._media.textTracks,a=0;a<e.length;a++)e[a].mode="disabled";this.curIndex=-1}},{key:"destroy",value:function(){var e=this._media.textTracks;e.removeEventListener("change",this._onChange),this._media=null,this._list=[],this._languages="",this.curIndex=-1}}]),r}(it),me={CLOSE:"close",TEXT_CLOSE:"text-close"};function et(t){var n=-1;return t.forEach(function(r,i){!r.id&&!r.language&&(r.id=i),r.id=String(r.id),!r.url&&(r.url=r.src),!r.text&&(r.text=r.label),!r.language&&(r.language=r.srclang),r.isDefault===void 0&&(r.isDefault=r.default||!1),(r.isDefault||r.default)&&(n<0?n=i:r.isDefault=r.default=!1)}),n}function pn(t,n){var r=h.isNotNull(t.id)&&h.isNotNull(n.id)&&t.id===n.id,i=h.isNotNull(t.language)&&h.isNotNull(n.language)&&t.language===n.language;return r||i}var mn=function(t){ne(r,t);var n=ie(r);function r(){var i;F(this,r);for(var e=arguments.length,a=new Array(e),s=0;s<e;s++)a[s]=arguments[s];return i=n.call.apply(n,[this].concat(a)),S(w(i),"_onOff",function(){i.switchOffSubtitle()}),S(w(i),"_onChange",function(o){var u=i.getSubTitleIndex(i.config.list,o);u<0||i.updateCurItem(u,o)}),S(w(i),"_onListReset",function(o){i.updateList(o)}),S(w(i),"clickSwitch",function(o,u){var l=u.type===me.CLOSE||u.type===me.TEXT_CLOSE;i.subTitles&&(l?i.subTitles.switchOff():i.switchSubTitle({language:u.language,id:u.id}))}),S(w(i),"onIconClick",function(o){i.curItem?i.subTitles.switchOff():i.switchOnSubtitle(o)}),S(w(i),"onPlayerFocus",function(o){!i.subTitles||!i.config.style.follow||i.rePosition()}),S(w(i),"onPlayerBlur",function(o){!i.subTitles||!i.config.style.follow||i.playerConfig.marginControls||i.subTitles.root&&(i.subTitles.root.style.transform="translate(0, 0)")}),i}return U(r,[{key:"beforeCreate",value:function(e){var a=e.player.config.texttrack||e.player.config.textTrack;h.typeOf(a)==="Array"&&(e.config.list=a)}},{key:"afterCreate",value:function(){var e=this.config,a=e.list,s=e.mode,o=et(a);N(C(r.prototype),"afterCreate",this).call(this),this.curIndex=-1,this.lastIndex=-1,this.curItem=null,this._nativeTracks=null,this.handlerClickSwitch=this.hook("subtitle_change",this.clickSwitch),s==="native"?this._initNativeSubtitle():this._initExtSubTitle(o)}},{key:"_initNativeSubtitle",value:function(){var e=this.player;e._subTitles||(e._subTitles=new dn(e.media)),this.subTitles=e._subTitles,this.subTitles.on("off",this._onOff),this.subTitles.on("change",this._onChange),this.subTitles.on("reset",this._onListReset)}},{key:"_initExtSubTitle",value:function(e){var a=this.config,s=a.list,o=a.style,u=a.isDefaultOpen,l=a.updateMode,c=a.renderMode;u&&e<0&&s.length>0&&(e=0,s[0].isDefault=!0);var f={subTitles:s,defaultOpen:u,updateMode:l,renderMode:c,debugger:this.config.debugger};Object.keys(o).map(function(g){f[g]=o[g]});var v=!this.playerConfig.marginControls&&this.player.controls.root;v&&(this.on(Oe,this.onPlayerFocus),this.on(ot,this.onPlayerBlur));var d=this.player;d._subTitles?d._subTitles._isOpen&&(e=this.getSubTitleIndex(this.config.list,d._subTitles.currentText)):(d._subTitles=new vn(f),d._subTitles.attachPlayer(this.player)),this.subTitles=d._subTitles,this.subTitles.on("off",this._onOff),this.subTitles.on("change",this._onChange),this.subTitles.on("reset",this._onListReset),o.follow&&this.subTitles.root&&h.addClass(this.subTitles.root,"follow-control"),this._renderList(s,u,e)}},{key:"_renderList",value:function(e,a,s){!e||e.length===0||(a?(s=s<0?0:s,e[s].isDefault=!0,this.curIndex=s,this.curItem=e[s],this.switchIconState(!0)):this.switchIconState(!1),this.player.isCanplay&&e.length>0&&(this.renderItemList(e),this.show()))}},{key:"registerIcons",value:function(){return{textTrackOpen:{icon:"",class:"xg-texttrak-open"},textTrackClose:{icon:"",class:"xg-texttrak-close"}}}},{key:"show",value:function(e){!this.config.list||this.config.list.length<1||h.addClass(this.root,"show")}},{key:"getSubTitleIndex",value:function(e){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{id:"",language:""},s=-1;return!a||!a.id&&!a.language||e.forEach(function(o,u){pn(o,a)&&(s=u)}),s}},{key:"updateSubtitles",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;e&&(this.updateList({list:e}),this.subTitles&&this.subTitles.setSubTitles(this.config.list,this.curIndex>-1,a))}},{key:"updateList",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(e.list){var a=[];e.list.forEach(function(o){a.push(o)});var s=et(a);e.isOpen?(this.curIndex=s,this.curItem=s>-1?a[s]:null):(this.curIndex=-1,this.curItem=null),this.config.list=a,a.length>0?this.show():(this.switchOffSubtitle(),this.hide()),this.renderItemList()}}},{key:"switchSubTitle",value:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:"",language:""};this.switchIconState(!0);var a=this.getSubTitleIndex(this.config.list,e);a<0||this.subTitles.switch(e).catch(function(s){})}},{key:"switchOffSubtitle",value:function(e){this.emit("subtitle_change",{off:!0,isListUpdate:!1,list:[]}),this.lastIndex=this.curIndex,this.curIndex=-1,this.curItem=null,this.switchIconState(!1),this.renderItemList()}},{key:"switchOnSubtitle",value:function(){var e=this.config.list,a=this.lastIndex>-1?this.lastIndex:0,s=e[a];this.switchIconState(!0),this.switchSubTitle(s)}},{key:"switchIconState",value:function(e){this.setAttr("data-state",e?"open":"close")}},{key:"onItemClick",value:function(e,a){var s=e.delegateTarget,o=s.getAttribute("language"),u=s.getAttribute("data-id"),l=s.getAttribute("data-type");N(C(r.prototype),"onItemClick",this).apply(this,arguments),this.handlerClickSwitch(e,{language:o,id:u,type:l})}},{key:"changeCurrentText",value:function(){if(!this.isIcons){var e=this.config,a=e.list,s=e.closeText,o=this.curIndex;if(o-1<0)this.find(".icon-text").innerHTML=this.getTextByLang(s,"iconText");else if(o-1<a.length){var u=a[o-1];if(!u)return;this.find(".icon-text").innerHTML=this.getTextByLang(u,"iconText")}}}},{key:"updateCurItem",value:function(e,a){this.curIndex=e,this.curItem=this.config.list[e-1],this.renderItemList(),this.emit("subtitle_change",Y({off:!1,isListUpdate:!1,list:[]},a))}},{key:"renderItemList",value:function(){var e=this,a=this.config,s=a.list,o=a.closeText,u=a.needCloseText,l=[],c=this.curIndex,f=this.curIndex;u&&(l.push({showText:this.getTextByLang(o),"data-type":me.TEXT_CLOSE,selected:this.curIndex===-1}),c++),s.map(function(v,d){var g={language:v.language||v.srclang||"","data-id":v.id||""};g.selected=e.curIndex===d,g.showText=e.getTextByLang(v),l.push(g)}),N(C(r.prototype),"renderItemList",this).call(this,l,c),this.curIndex=f,this.curItem=s[f]}},{key:"rePosition",value:function(){var e=this.config.style.fitVideo,a=this.player.controls.root.getBoundingClientRect(),s=0-a.height;if(!e){this.subTitles.root.style.transform="translate(0, ".concat(s,"px)");return}var o=this.player,u=o.video,l=o.root,c=l.getBoundingClientRect(),f=c.height,v=c.width,d=u.videoHeight,g=u.videoWidth,m=parseInt(d/g*100,10),p=m*v/100;p>f&&(p=f);var y=(f-p)/2-s;y<0&&(this.subTitles.root.style.transform="translate(0, ".concat(y,"px)"))}},{key:"destroy",value:function(){this.subTitles&&(this.subTitles.destroy(),this.subTitles=null),N(C(r.prototype),"destroy",this).call(this)}}],[{key:"pluginName",get:function(){return"texttrack"}},{key:"defaultConfig",get:function(){return Y(Y({},je.defaultConfig),{},{position:ae.CONTROLS_RIGHT,index:6,list:[],isDefaultOpen:!0,style:{follow:!0,mode:"stroke",followBottom:50,fitVideo:!0,offsetBottom:2,baseSizeX:49,baseSizeY:28,minSize:16,minMobileSize:13,line:"double",fontColor:"#fff"},closeText:{text:"",iconText:""},needCloseText:!0,className:"xgplayer-texttrack",hidePortrait:!1,isShowIcon:!0,renderMode:"normal",mode:"external",debugger:!1})}}]),r}(je);const xn=Object.freeze(Object.defineProperty({__proto__:null,default:mn},Symbol.toStringTag,{value:"Module"}));export{Oe as $,tr as A,Dr as B,nr as C,ar as D,Pt as E,ut as F,rr as G,Nr as H,jt as I,gr as J,Y as K,zt as L,hr as M,dr as N,wr as O,ft as P,Pr as Q,Qt as R,Ir as S,mn as T,sr as U,Ar as V,Bt as W,A as X,ir as Y,fr as Z,U as _,Ht as a,ot as a0,Ut as a1,cr as a2,Tr as a3,lt as a4,Ae as a5,Le as a6,ke as a7,Sn as a8,wn as a9,Nt as aa,Xt as ab,Wt as ac,x as ad,$t as ae,Yt as af,Mt as ag,Rt as ah,Or as ai,lr as aj,ur as ak,Er as al,_r as am,yr as an,br as ao,je as ap,Vt as aq,Lr as ar,or as as,kr as at,On as au,xn as av,kt as b,F as c,ne as d,ie as e,S as f,xr as g,N as h,C as i,it as j,Tn as k,rt as l,w as m,ae as n,wt as o,st as p,Sr as q,En as r,Ee as s,bn as t,h as u,Rr as v,_n as w,mt as x,Dt as y,er as z};
