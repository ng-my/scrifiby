const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./y8cjFsai.js","./CindA9jZ.js","./DjTJqZtn.js","./entry.DofVldok.css"])))=>i.map(i=>d[i]);
import{_ as Z,r as c,k as ee,o as te,O as ne,z as u,B as r,P as $,Q as z,R as _,S as E,T as se,V as C,A as d,F as T,G as p}from"./DjTJqZtn.js";/* empty css        */const oe={class:"detail-box w-full flex flex-col"},ie={class:"p-5 sm:p-6 bg-purple-200 overflow-y-auto",id:"right-btn"},ae={key:0,class:"transcript-container"},le={key:0,class:"mb-6 bg-white p-4 rounded-lg shadow"},re={class:"text-sm text-gray-500 mb-1"},ce={class:"text-md"},ue={class:"text-sm text-gray-500 mb-2"},de={class:"text-lg leading-relaxed whitespace-normal break-words"},ve=["onClick"],me={class:"mt-3 text-gray-600 text-sm"},ge={__name:"video",setup(pe){const P=c(null),k=c(!1),S=c(0),y=c(1),I=c(1),w=c(!1),b=c(!1),v=c(null),x=c({paraIndex:-1,sentIndex:-1,contentIndex:-1}),f=c(0),O=c({}),A=c([]),L=c([]),F=e=>!e||!e.sentences?"":e.sentences.map(n=>n.contents.map(s=>s.content).join("")).join(" "),R=(e,n,s,o)=>{const a=e.start_time!==void 0&&e.stop_time!==void 0&&f.value>=e.start_time/1e3&&f.value<=e.stop_time/1e3;return x.value.paraIndex===n&&x.value.sentIndex===s&&x.value.contentIndex===o||a},M=()=>{if(!v.value)return;let e=!1,n=null;for(let s=0;s<v.value.paragraphs.length;s++){const o=v.value.paragraphs[s];for(let a=0;a<o.sentences.length;a++){const t=o.sentences[a];for(let i=0;i<t.contents.length;i++){const l=t.contents[i];if(l.start_time!==void 0&&l.stop_time!==void 0&&f.value>=l.start_time/1e3&&f.value<=l.stop_time/1e3&&!e){e=!0,n=O.value[`${s}-${a}-${i}`];break}}if(e)break}if(e)break}n&&n.scrollIntoView({behavior:"smooth",block:"center"})},N=()=>{if(!v.value||!v.value.paragraphs)return[];const e=/[，。！？；：,.!?;:]/,n=[];return v.value.paragraphs.forEach(s=>{s.sentences&&s.sentences.forEach(o=>{if(!o.contents||o.contents.length===0)return;const a=[];let t=0;for(;t<o.contents.length;){const i=o.contents[t];if(e.test(i.content))a.push({cid:i.cid,language:i.language,start_time:i.start_time,stop_time:i.stop_time,content:i.content}),t++;else{let l={cid:i.cid,language:i.language,start_time:i.start_time,stop_time:i.stop_time,content:i.content},m=t+1;for(;m<o.contents.length;){const g=o.contents[m];if(l.content+=g.content,l.stop_time=g.stop_time,e.test(g.content)){m++;break}m++}a.push({...l}),t=m}}a.forEach(i=>{n.push({...i,speaker:s.pid})})})}),console.log("result",n),n},j=()=>{if(!v.value||!v.value.paragraphs)return[];const e=N();if(console.log("🚀 ~ file: video.vue method: processOverlappingSegments line: 251 🚀",e),!e.length)return[];e.sort((t,i)=>parseInt(t.start_time)-parseInt(i.start_time));const n=[],s=[];e.forEach(t=>{const i=parseInt(t.start_time),l=parseInt(t.stop_time);s.push({time:i,type:"start",item:t}),s.push({time:l,type:"end",item:t})}),s.sort((t,i)=>t.time-i.time);const o=new Set;let a=s[0].time;for(let t=0;t<s.length;t++){const i=s[t],l=i.time;if(o.size>0&&l>a){const m={start:a/1e3,end:l/1e3,text:Array.from(o).map(g=>g.content),textObj:Array.from(o).map(g=>({content:g.content,speaker:g.speaker}))};(new Set(Array.from(o).map(g=>g.speaker)).size>1||o.size===1&&l-a>100)&&n.push(m)}i.type==="start"?o.add(i.item):o.delete(i.item),a=l}return n},X=()=>{if(!v.value)return;const e=j();console.log(e),L.value=e;const n=f.value;A.value=e.filter(s=>n>=s.start&&n<=s.end)},B=ee(()=>w.value?`grid-template-columns: ${y.value}fr 8px ${I.value}fr;`:"grid-template-columns: 1fr; grid-template-rows: 1fr 1fr;"),D=()=>{var e;w.value=((e=P.value)==null?void 0:e.offsetWidth)>=768||window.innerWidth>=768},U=()=>{w.value&&(b.value=!0)},G=()=>{k.value||(b.value=!1)},H=e=>{!b.value||!w.value||(k.value=!0,S.value=e.clientX,window.addEventListener("mousemove",V),window.addEventListener("mouseup",W),document.body.classList.add("no-select"))},V=e=>{var i;if(!k.value)return;const n=e.clientX-S.value,s=((i=P.value)==null?void 0:i.offsetWidth)||800,o=y.value+I.value,a=y.value+n/s*o,t=.5;y.value=Math.max(t,Math.min(a,o-t)),I.value=o-y.value,S.value=e.clientX},W=()=>{k.value=!1,b.value=!1,window.removeEventListener("mousemove",V),window.removeEventListener("mouseup",W),document.body.classList.remove("no-select")},Q=(e,n,s,o)=>{if(console.log(`Word clicked: ${e.content}, Start: ${e.start_time}, End: ${e.stop_time}`),x.value={paraIndex:n,sentIndex:s,contentIndex:o},h.value&&e.start_time!==void 0){const a=!h.value.paused;console.log("wasPlaying",a),h.value.seek(e.start_time/1e3,a?"play":"pause")}},q=e=>{f.value=e},J=async()=>{{const e=(await C(async()=>{const{default:a}=await import("./y8cjFsai.js").then(t=>t.i);return{default:a}},__vite__mapDeps([0,1,2,3]),import.meta.url)).default,n=(await C(async()=>{const{default:a}=await import("./CindA9jZ.js").then(t=>t.av);return{default:a}},__vite__mapDeps([1,2,3]),import.meta.url)).default,s=(await C(async()=>{const{Events:a}=await import("./y8cjFsai.js").then(t=>t.i);return{Events:a}},__vite__mapDeps([0,1,2,3]),import.meta.url)).Events,o=(await C(async()=>{const{Plugin:a}=await import("./y8cjFsai.js").then(t=>t.i);return{Plugin:a}},__vite__mapDeps([0,1,2,3]),import.meta.url)).Plugin;return{Player:e,TextTrack:n,EVENTS:s,Plugin:o}}},K=async()=>{try{const e=await fetch("/video.json");v.value=await e.json(),console.log("Transcript data loaded:111",v.value),X()}catch(e){console.error("Error loading transcript data:",e)}};c(null);const h=c(null),Y=c([]);return te(async()=>{D(),window.addEventListener("resize",D),await K(),Y.value=[];const{Player:e,TextTrack:n,Plugin:s,EVENTS:o}=await J();console.log("🚀 ~ file: video.vue method:  line: 477 🚀",s);const{POSITIONS:a}=s;class t extends s{static get pluginName(){return"demoPlugin"}static get defaultConfig(){return{position:a.CONTROLS_RIGHT,index:100}}constructor(l){super(l),this.status=!0}beforePlayerInit(){}afterPlayerInit(){}afterCreate(){this.icon=this.find(".icon"),this.onIconClick=l=>{console.log("class为icon元素点击回调")},this.onClick=()=>{console.log("当前插件根节点点击事件");const l=this.getPlugin("texttrack");console.log("🚀 ~ file: video.vue method: onClick line: 516 🚀",l),console.log("🚀 ~ file: video.vue method: onClick line: 518 🚀",this.status),this.status=!this.status,this.status?l.switchOnSubtitle():l.subTitles.switchOff()},this.bind(".icon","click",this.onIconClick),this.bind("click",this.onClick)}destroy(){this.unbind(".icon","click",this.onIconClick),this.unbind("click",this.onClick),this.icon=null}render(){return`
      <xg-icon class='xgplayer-demoPlugin'>
        <div class="xgplayer-icon">
           demoPlugin
        </div>
        <div class="xg-tips"">
         demoPlugin-tip
        </div>
      </xg-icon>
      `}}h.value=new e({id:"mse",url:"/video.mp4",volume:.8,width:"100%",height:"100%",fitVideoSize:"fixWidth",plugins:[n,t],controls:{initShow:!0,mode:"normal"},playbackRate:{hidePortrait:!1,listType:"default"},textTrack:{debugger:!1,isIcons:!0,list:[{id:"vtt1",language:"zh-cn",text:"字幕1",default:!0,list:[{start:0,end:600,list:L.value}]}]},icons:{textTrack:()=>{console.log("🚀 ~ file: video.vue method: play line: 515 🚀")}},marginControls:!1,videoConfig:{crossOrigin:"anonymous"}}),h.value.on(o.TIME_UPDATE,()=>{x.value={paraIndex:-1,sentIndex:-1,contentIndex:-1},q(h.value.currentTime),M()})}),ne(()=>{window.removeEventListener("resize",D)}),(e,n)=>(d(),u("div",oe,[r("div",{ref_key:"container",ref:P,class:"flex-1 bg-gray-100 draggable-panels grid-container rounded-xl overflow-hidden",style:se(B.value)},[n[6]||(n[6]=r("div",{class:"p-5 sm:p-6 bg-gray-100"},[r("div",{id:"mse"})],-1)),w.value?(d(),u("div",{key:0,class:z(["drag-handle",{dragging:k.value,"drag-disabled":!b.value}]),onMousedown:H,onMouseenter:U,onMouseleave:G},null,34)):$("",!0),r("div",ie,[v.value?(d(),u("div",ae,[A.value.length>0?(d(),u("div",le,[n[2]||(n[2]=r("h3",{class:"text-lg font-bold mb-2"},"当前重叠语音段落",-1)),(d(!0),u(_,null,E(A.value,(s,o)=>(d(),u("div",{key:o,class:"mb-3 p-2 bg-gray-50 rounded"},[r("div",re,[n[0]||(n[0]=r("span",{class:"font-semibold"},"开始:",-1)),T(" "+p((s.start/1e3).toFixed(2))+"秒 | ",1),n[1]||(n[1]=r("span",{class:"font-semibold"},"结束:",-1)),T(" "+p((s.end/1e3).toFixed(2))+"秒 ",1)]),r("div",ce,[(d(!0),u(_,null,E(s.text,(a,t)=>(d(),u("div",{key:t,class:"mb-1"},p(a.content),1))),128))])]))),128))])):$("",!0),(d(!0),u(_,null,E(v.value.paragraphs,(s,o)=>(d(),u("div",{key:o,class:"mb-6 bg-white p-4 rounded-lg shadow"},[r("div",ue,[n[3]||(n[3]=r("span",{class:"font-semibold"},"Speaker:",-1)),T(" "+p(s.pid)+" | ",1),n[4]||(n[4]=r("span",{class:"font-semibold"},"Start:",-1)),T(" "+p(s.start_time)+" | ",1),n[5]||(n[5]=r("span",{class:"font-semibold"},"End:",-1)),T(" "+p(s.stop_time),1)]),r("div",de,[(d(!0),u(_,null,E(s.sentences,(a,t)=>(d(),u(_,{key:`${o}-sent-${t}`},[(d(!0),u(_,null,E(a.contents,(i,l)=>(d(),u("span",{key:`${o}-${t}-${l}`,onClick:m=>Q(i,o,t,l),class:z(["cursor-pointer transition-colors px-0.5 rounded mx-0.5 inline-block",R(i,o,t,l)?"bg-blue-100 text-white":"hover:bg-blue-100"]),ref_for:!0,ref:m=>{m&&(O.value[`${o}-${t}-${l}`]=m)}},p(i.content),11,ve))),128))],64))),128))]),r("div",me,p(F(s)),1)]))),128))])):$("",!0)])],4),n[7]||(n[7]=r("div",{class:"audio-container h-20 bg-red-300"},[r("div",{id:"audioID",class:""})],-1))]))}},_e=Z(ge,[["__scopeId","data-v-428ce0a2"]]);export{_e as default};
